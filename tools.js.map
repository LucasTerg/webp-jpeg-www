{"version":3,"mappings":";2iCAIA,IAAIA,EAAa,CAAE,EACfC,EAAUC,EAAWC,EAAUC,EAAUC,EAAYC,EAAYC,EAAaC,EAAsBC,EAAeC,EAAkBC,EAASC,EAElJ,SAAS,iBAAiB,mBAAoB,IAAM,CAChD,QAAQ,IAAI,iCAAiC,EAG7CX,EAAW,SAAS,eAAe,eAAe,EAClDC,EAAY,SAAS,eAAe,YAAY,EAChDC,EAAW,SAAS,eAAe,WAAW,EAC9CC,EAAW,SAAS,eAAe,YAAY,EAC/CC,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAuB,SAAS,eAAe,iBAAiB,EAGhEC,EAAgB,SAAS,eAAe,WAAW,EACnDC,EAAmB,SAAS,eAAe,cAAc,EACzDC,EAAU,SAAS,eAAe,UAAU,EAC5CC,EAAY,SAAS,eAAe,YAAY,EAIhD,MAAMC,EAAa,aAAa,QAAQ,OAAO,GAAK,OACpD,SAAS,gBAAgB,aAAa,aAAcA,CAAU,EAE3DN,GACCA,EAAY,iBAAiB,QAAS,IAAM,CAExC,MAAMO,EADU,SAAS,gBAAgB,aAAa,YAAY,IACzC,QAAU,OAAS,QAC5C,SAAS,gBAAgB,aAAa,aAAcA,CAAI,EACxD,aAAa,QAAQ,QAASA,CAAI,EAClCC,EAAI,qBAAqBD,CAAI,EAAE,CAC3C,CAAS,EAIFb,GAAYC,GACXD,EAAS,iBAAiB,QAAS,IAAM,CACrC,QAAQ,IAAI,kBAAkB,EAC9BC,EAAU,MAAO,CAC7B,CAAS,EAEDA,EAAU,iBAAiB,SAAW,GAAM,CACxCc,EAAS,EAAE,OAAO,KAAK,EACvBd,EAAU,MAAQ,EAC9B,CAAS,EAEDD,EAAS,iBAAiB,WAAa,GAAM,CACzC,EAAE,eAAgB,EAClBA,EAAS,MAAM,YAAc,qBACzC,CAAS,EAEDA,EAAS,iBAAiB,YAAc,GAAM,CAC1C,EAAE,eAAgB,EAClBA,EAAS,MAAM,YAAc,qBACzC,CAAS,EAEDA,EAAS,iBAAiB,OAAS,GAAM,CACrC,EAAE,eAAgB,EAClBA,EAAS,MAAM,YAAc,sBAC7Be,EAAS,EAAE,aAAa,KAAK,CACzC,CAAS,GAED,QAAQ,MAAM,uCAAuC,EAGtDZ,GACCA,EAAS,iBAAiB,QAAS,IAAM,CACrCJ,EAAa,CAAE,EACfiB,EAAY,EACZF,EAAI,qBAAqB,CACrC,CAAS,EAIFN,IACCA,EAAc,iBAAiB,aAAc,SAAY,CACrD,GAAIA,EAAc,MAAM,KAAI,IAAO,GACnC,GAAI,CACA,MAAMS,EAAO,MAAM,UAAU,UAAU,SAAU,EACjD,GAAIA,EAAM,CACN,MAAMC,EAAYC,EAAaF,CAAI,EAC/BC,IACAV,EAAc,MAAQU,EACtBV,EAAc,UAAU,IAAI,aAAa,EACzC,WAAW,IAAMA,EAAc,UAAU,OAAO,aAAa,EAAG,GAAG,EACnEM,EAAI,wBAAwBI,CAAS,EAAE,EAE/D,CACa,MAAa,EAC1B,CAAS,EAEDV,EAAc,iBAAiB,QAAS,IAAM,CAC1C,MAAMY,EAAWZ,EAAc,MACzBa,EAAYF,EAAaC,CAAQ,EACnCA,IAAaC,IACbb,EAAc,MAAQa,EAEtC,CAAS,GAIFjB,GACCA,EAAW,iBAAiB,QAAS,SAAY,CAE7CkB,EAAc,CAC1B,CAAS,CAET,CAAC,EAGD,eAAeA,GAAe,CAC5B,GAAIvB,EAAW,SAAW,EAAG,CAC3Be,EAAI,qCAAqC,EACzC,MACJ,CAEE,MAAMS,EAAWf,EAAc,MAAM,KAAM,GAAI,QACzCgB,EAAW,SAASf,EAAiB,KAAK,GAAK,EAC/CgB,EAAOlB,EAAqB,MAIlC,GAFAO,EAAI,4BAA4BW,IAAS,QAAU,WAAa,QAAQ,MAAM,EAE1EA,IAAS,QAAS,CACpB,MAAMC,EAAU,CACd,SAAAH,EACA,YAAaC,EACb,QAASd,EAAQ,QACjB,UAAWC,EAAU,OACtB,EAED,GAAI,CACF,KAAM,CAAE,uBAAAgB,CAAsB,EAAK,MAAMC,EAAA,uCAAAD,GAAA,aAAO,uCAAuB,4DACjEE,EAAU,MAAMF,EAAuB5B,EAAY2B,EAAUI,GAAQhB,EAAIgB,CAAG,CAAC,EAE7EC,EAAM,OAAO,IAAI,gBAAgBF,CAAO,EACxCG,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOD,EACTC,EAAE,SAAW,gBACb,SAAS,KAAK,YAAYA,CAAC,EAC3BA,EAAE,MAAO,EACTA,EAAE,OAAQ,EACVlB,EAAI,4BAA4B,CACjC,OAAQmB,EAAG,CACVnB,EAAI,iBAAiBmB,EAAE,OAAO,EAAE,CACtC,CACI,MACJ,CAGE,MAAMC,EAAW,IAAI,SACrBnC,EAAW,QAASoC,GAAS,CAC3BD,EAAS,OAAO,SAAUC,EAAK,IAAI,CACvC,CAAG,EACDD,EAAS,OAAO,UAAWX,CAAQ,EACnCW,EAAS,OAAO,cAAeV,CAAQ,EACvCU,EAAS,OAAO,UAAWxB,EAAQ,OAAO,EAC1CwB,EAAS,OAAO,YAAavB,EAAU,OAAO,EAE9C,GAAI,CAEF,MAAMyB,EAAW,MAAM,MADP,qCACsB,CAAE,OAAQ,OAAQ,KAAMF,EAAU,EAExE,GAAIE,EAAS,GAAI,CACftB,EAAI,6BAA6B,EACjC,MAAMuB,EAAO,MAAMD,EAAS,KAAM,EAC5BL,EAAM,OAAO,IAAI,gBAAgBM,CAAI,EACrCL,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOD,EACTC,EAAE,SAAW,gBACb,SAAS,KAAK,YAAYA,CAAC,EAC3BA,EAAE,MAAO,EACTA,EAAE,OAAQ,EACVlB,EAAI,iCAAiC,CAC3C,KAAW,CACL,MAAMwB,EAAU,MAAMF,EAAS,KAAM,EACrCtB,EAAI,iBAAiBwB,CAAO,EAAE,CACpC,CACG,OAAQC,EAAO,CACdzB,EAAI,eAAeyB,EAAM,OAAO,EAAE,CACtC,CACA,CAIA,SAASzB,EAAI0B,EAAS,CACpB,GAAG,CAACnC,EAAY,OAChB,MAAMoC,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,YAAc,KAAKD,CAAO,GAC5BnC,EAAW,YAAYoC,CAAC,EACxBpC,EAAW,UAAYA,EAAW,YACpC,CAGA,MAAMc,EAAeuB,GAAO,CAC1B,MAAMC,EAAM,CACV,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IACrF,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,GACtF,EACD,IAAIC,EAAYF,EAAI,QAAQ,wBAAyBG,GAASF,EAAIE,CAAK,CAAC,EACxE,OAAAD,EAAYA,EAAU,QAAQ,gBAAiB,GAAG,EAClDA,EAAYA,EAAU,QAAQ,MAAO,GAAG,EACxCA,EAAYA,EAAU,QAAQ,WAAY,EAAE,EACrCA,CACT,EAIA,SAAS5B,GAAa,CAChBd,IACJA,EAAS,UAAY,GACrBH,EAAW,QAAQ,CAACoC,EAAMW,IAAU,CAClC,MAAMC,EAAK,SAAS,cAAc,IAAI,EACtCA,EAAG,UAAY,YAEfA,EAAG,UAAY;AAAA,iCACcD,EAAQ,CAAC,KAAKX,EAAK,KAAK,IAAI,MAAMA,EAAK,KAAK,KAAO,MAAM,QAAQ,CAAC,CAAC;AAAA;AAAA,4DAExCW,CAAK;AAAA,8DACHA,CAAK;AAAA,gEACHA,CAAK;AAAA;AAAA,MAGjE5C,EAAS,YAAY6C,CAAE,CAC3B,CAAG,EACH,CAEA,SAAShC,EAASiC,EAAO,CACvB,MAAM,KAAKA,CAAK,EAAE,QAAQC,GAAQ,CAC5BA,EAAK,KAAK,WAAW,QAAQ,GAC/BlD,EAAW,KAAK,CAAE,KAAAkD,EAAM,GAAI,KAAK,MAAQ,KAAK,OAAM,EAAI,EACxDnC,EAAI,WAAWmC,EAAK,IAAI,EAAE,GAE1BnC,EAAI,SAASmC,EAAK,IAAI,oBAAoB,CAEhD,CAAG,EACDjC,EAAY,CACd,CAGA,OAAO,OAAU8B,GAAU,CACrBA,EAAQ,IACV,CAAC/C,EAAW+C,EAAQ,CAAC,EAAG/C,EAAW+C,CAAK,CAAC,EAAI,CAAC/C,EAAW+C,CAAK,EAAG/C,EAAW+C,EAAQ,CAAC,CAAC,EACtF9B,EAAY,EAEhB,EAEA,OAAO,SAAY8B,GAAU,CACvBA,EAAQ/C,EAAW,OAAS,IAC9B,CAACA,EAAW+C,EAAQ,CAAC,EAAG/C,EAAW+C,CAAK,CAAC,EAAI,CAAC/C,EAAW+C,CAAK,EAAG/C,EAAW+C,EAAQ,CAAC,CAAC,EACtF9B,EAAY,EAEhB,EAEA,OAAO,WAAc8B,GAAU,CAC7BhC,EAAI,aAAaf,EAAW+C,CAAK,EAAE,KAAK,IAAI,EAAE,EAC9C/C,EAAW,OAAO+C,EAAO,CAAC,EAC1B9B,EAAY,CACd","names":["filesQueue","dropzone","fileInput","fileList","clearBtn","executeBtn","consoleLog","themeToggle","processingModeSelect","baseNameInput","startNumberInput","optCrop","optResize","savedTheme","next","log","addFiles","renderList","text","cleanText","sanitizeName","original","sanitized","executeLogic","baseName","startNum","mode","options","processFilesClientSide","__vitePreload","zipBlob","msg","url","a","e","formData","item","response","blob","errText","error","message","p","str","map","processed","match","index","li","files","file"],"ignoreList":[],"sources":["../src/js/tools.js"],"sourcesContent":["// import { processFilesClientSide } from './client-processor.js'; // USUNIĘTE (Dynamic import poniżej)\n\n// alert(\"Tools script loaded!\");\n\nlet filesQueue = [];\nlet dropzone, fileInput, fileList, clearBtn, executeBtn, consoleLog, themeToggle, processingModeSelect, baseNameInput, startNumberInput, optCrop, optResize, optBgRemove;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    console.log(\"DOM Loaded - initializing Tools\");\n\n    // Elementy DOM\n    dropzone = document.getElementById('file-dropzone');\n    fileInput = document.getElementById('file-input');\n    fileList = document.getElementById('file-list');\n    clearBtn = document.getElementById('clear-list');\n    executeBtn = document.getElementById('execute-btn');\n    consoleLog = document.getElementById('console-log');\n    themeToggle = document.getElementById('theme-toggle');\n    processingModeSelect = document.getElementById('processing-mode');\n\n    // Ustawienia\n    baseNameInput = document.getElementById('base-name');\n    startNumberInput = document.getElementById('start-number');\n    optCrop = document.getElementById('opt-crop');\n    optResize = document.getElementById('opt-resize');\n    // optBgRemove = document.getElementById('opt-bg-remove');\n\n    // --- THEME SWITCH INIT ---\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    document.documentElement.setAttribute('data-theme', savedTheme);\n    \n    if(themeToggle) {\n        themeToggle.addEventListener('click', () => {\n            const current = document.documentElement.getAttribute('data-theme');\n            const next = current === 'light' ? 'dark' : 'light';\n            document.documentElement.setAttribute('data-theme', next);\n            localStorage.setItem('theme', next);\n            log(`Zmiana motywu na: ${next}`);\n        });\n    }\n\n    // --- OBSŁUGA DRAG & DROP ---\n    if(dropzone && fileInput) {\n        dropzone.addEventListener('click', () => {\n            console.log(\"Dropzone clicked\");\n            fileInput.click();\n        });\n\n        fileInput.addEventListener('change', (e) => {\n            addFiles(e.target.files);\n            fileInput.value = ''; \n        });\n\n        dropzone.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            dropzone.style.borderColor = 'var(--accent-color)';\n        });\n\n        dropzone.addEventListener('dragleave', (e) => {\n            e.preventDefault();\n            dropzone.style.borderColor = 'var(--border-color)';\n        });\n\n        dropzone.addEventListener('drop', (e) => {\n            e.preventDefault();\n            dropzone.style.borderColor = 'var(--border-color)';\n            addFiles(e.dataTransfer.files);\n        });\n    } else {\n        console.error(\"Brak elementu dropzone lub fileInput!\");\n    }\n\n    if(clearBtn) {\n        clearBtn.addEventListener('click', () => {\n            filesQueue = [];\n            renderList();\n            log('Lista wyczyszczona.');\n        });\n    }\n\n    // --- SANITYZACJA I SCHOWEK ---\n    if(baseNameInput) {\n        baseNameInput.addEventListener('mouseenter', async () => {\n            if (baseNameInput.value.trim() !== '') return;\n            try {\n                const text = await navigator.clipboard.readText();\n                if (text) {\n                    const cleanText = sanitizeName(text);\n                    if (cleanText) {\n                        baseNameInput.value = cleanText;\n                        baseNameInput.classList.add('flash-input');\n                        setTimeout(() => baseNameInput.classList.remove('flash-input'), 500);\n                        log(`Wklejono ze schowka: ${cleanText}`);\n                    }\n                }\n            } catch (err) {}\n        });\n\n        baseNameInput.addEventListener('input', () => {\n            const original = baseNameInput.value;\n            const sanitized = sanitizeName(original);\n            if (original !== sanitized) {\n                baseNameInput.value = sanitized;\n            }\n        });\n    }\n\n    // --- WYKONANIE (UPLOAD) ---\n    if(executeBtn) {\n        executeBtn.addEventListener('click', async () => {\n            // ... (logika executeBtn przeniesiona tutaj, korzystająca ze zmiennych z closure)\n            executeLogic();\n        });\n    }\n});\n\n// Funkcja pomocnicza dla execute, żeby nie robić gigantycznego zagnieżdżenia\nasync function executeLogic() {\n  if (filesQueue.length === 0) {\n    log('BŁĄD: Brak plików do przetworzenia.');\n    return;\n  }\n\n  const baseName = baseNameInput.value.trim() || 'image';\n  const startNum = parseInt(startNumberInput.value) || 1;\n  const mode = processingModeSelect.value;\n\n  log(`Rozpoczynanie procedury (${mode === 'local' ? 'LOKALNIE' : 'SERWER'})...`);\n\n  if (mode === 'local') {\n    const options = { \n      baseName, \n      startNumber: startNum, \n      optCrop: optCrop.checked, \n      optResize: optResize.checked \n    };\n\n    try {\n      const { processFilesClientSide } = await import('./client-processor.js');\n      const zipBlob = await processFilesClientSide(filesQueue, options, (msg) => log(msg));\n      \n      const url = window.URL.createObjectURL(zipBlob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'processed.zip';\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      log('SUKCES: Gotowe (Lokalnie).');\n    } catch (e) {\n      log(`BŁĄD LOKALNY: ${e.message}`);\n    }\n    return;\n  }\n\n  // SERVER MODE\n  const formData = new FormData();\n  filesQueue.forEach((item) => {\n    formData.append('images', item.file);\n  });\n  formData.append('newName', baseName);\n  formData.append('startNumber', startNum);\n  formData.append('optCrop', optCrop.checked);\n  formData.append('optResize', optResize.checked);\n\n  try {\n    const API_URL = 'http://localhost:3000/upload-tools';\n    const response = await fetch(API_URL, { method: 'POST', body: formData });\n\n    if (response.ok) {\n      log('SUKCES: Pliki przetworzone.');\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'processed.zip';\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      log('Rozpoczęto pobieranie archiwum.');\n    } else {\n      const errText = await response.text();\n      log(`BŁĄD SERWERA: ${errText}`);\n    }\n  } catch (error) {\n    log(`BŁĄD SIECI: ${error.message}`);\n  }\n}\n\n\n// --- LOGOWANIE ---\nfunction log(message) {\n  if(!consoleLog) return;\n  const p = document.createElement('p');\n  p.textContent = `> ${message}`;\n  consoleLog.appendChild(p);\n  consoleLog.scrollTop = consoleLog.scrollHeight;\n}\n\n// --- SANITYZACJA ---\nconst sanitizeName = str => {\n  const map = {\n    'ą': 'a', 'ć': 'c', 'ę': 'e', 'ł': 'l', 'ń': 'n', 'ó': 'o', 'ś': 's', 'ź': 'z', 'ż': 'z',\n    'Ą': 'A', 'Ć': 'C', 'Ę': 'E', 'Ł': 'L', 'Ń': 'N', 'Ó': 'O', 'Ś': 'S', 'Ź': 'Z', 'Ż': 'Z'\n  };\n  let processed = str.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g, match => map[match]);\n  processed = processed.replace(/[^a-zA-Z0-9]/g, '-');\n  processed = processed.replace(/-+/g, '-');\n  processed = processed.replace(/^-+|-+$/g, '');\n  return processed;\n};\n\n// --- ZARZĄDZANIE PLIKAMI ---\n\nfunction renderList() {\n  if(!fileList) return;\n  fileList.innerHTML = '';\n  filesQueue.forEach((item, index) => {\n    const li = document.createElement('li');\n    li.className = 'file-item';\n    \n    li.innerHTML = `\n      <span class=\"file-info\">[${index + 1}] ${item.file.name} (${(item.file.size / 1024).toFixed(1)} KB)</span>\n      <div class=\"file-controls\">\n        <button class=\"btn btn-sm\" onclick=\"window.moveUp(${index})\">▲</button>\n        <button class=\"btn btn-sm\" onclick=\"window.moveDown(${index})\">▼</button>\n        <button class=\"btn btn-sm\" onclick=\"window.removeFile(${index})\" style=\"color:var(--error-color); border-color:var(--error-color);\">X</button>\n      </div>\n    `;\n    fileList.appendChild(li);\n  });\n}\n\nfunction addFiles(files) {\n  Array.from(files).forEach(file => {\n    if (file.type.startsWith('image/')) {\n      filesQueue.push({ file, id: Date.now() + Math.random() });\n      log(`Dodano: ${file.name}`);\n    } else {\n      log(`BŁĄD: ${file.name} nie jest obrazem.`);\n    }\n  });\n  renderList();\n}\n\n// Funkcje globalne\nwindow.moveUp = (index) => {\n  if (index > 0) {\n    [filesQueue[index - 1], filesQueue[index]] = [filesQueue[index], filesQueue[index - 1]];\n    renderList();\n  }\n};\n\nwindow.moveDown = (index) => {\n  if (index < filesQueue.length - 1) {\n    [filesQueue[index + 1], filesQueue[index]] = [filesQueue[index], filesQueue[index + 1]];\n    renderList();\n  }\n};\n\nwindow.removeFile = (index) => {\n  log(`Usunięto: ${filesQueue[index].file.name}`);\n  filesQueue.splice(index, 1);\n  renderList();\n};"],"file":"tools.js"}
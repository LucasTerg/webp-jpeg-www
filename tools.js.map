{"version":3,"mappings":"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","names":["filesQueue","dropzone","fileInput","fileList","clearBtn","executeBtn","consoleLog","themeToggle","processingModeSelect","baseNameInput","startNumberInput","optCrop","optTrimOnly","optAddMargin","optResize","log","savedTheme","next","e","addFiles","renderList","updateFromClipboard","text","cleanText","sanitizeName","original","sanitized","executeLogic","message","p","str","map","processed","match","item","index","li","checkbox","span","showPreview","hidePreview","movePreview","divControls","tooltip","file","url","x","y","loadImageDimensions","resolve","reject","img","files","filesToAdd","width","height","error","targetItem","initialCount","removedCount","selectedFiles","baseName","startNum","mode","filePaths","options","msg","result","processFilesClientSide","__vitePreload","zipBlob","a","formData","response","blob","errText"],"ignoreList":[],"sources":["../src/js/tools.js"],"sourcesContent":["// import { processFilesClientSide } from './client-processor.js'; // USUNIĘTE (Dynamic import poniżej)\n\n// alert(\"Tools script loaded!\");\n\nlet filesQueue = [];\nlet dropzone, fileInput, fileList, clearBtn, executeBtn, consoleLog, themeToggle, processingModeSelect, baseNameInput, startNumberInput, optCrop, optTrimOnly, optAddMargin, optResize, optBgRemove;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    console.log(\"DOM Loaded - initializing Tools\");\n\n    // Elementy DOM\n    dropzone = document.getElementById('file-dropzone');\n    fileInput = document.getElementById('file-input');\n    fileList = document.getElementById('file-list');\n    clearBtn = document.getElementById('clear-list');\n    executeBtn = document.getElementById('execute-btn');\n    consoleLog = document.getElementById('console-log');\n    themeToggle = document.getElementById('theme-toggle');\n    processingModeSelect = document.getElementById('processing-mode');\n\n    // Ustawienia\n    baseNameInput = document.getElementById('base-name');\n    startNumberInput = document.getElementById('start-number');\n    optCrop = document.getElementById('opt-crop');\n    optTrimOnly = document.getElementById('opt-trim-only');\n    optAddMargin = document.getElementById('opt-add-margin');\n    optResize = document.getElementById('opt-resize');\n    // optBgRemove = document.getElementById('opt-bg-remove');\n\n    // --- DETEKCJA ELECTRONA (Desktop) ---\n    if (window.electronAPI) {\n        document.body.classList.add('is-electron');\n        log('Tryb Desktop (Electron) aktywny.');\n        \n        // Ustawienia domyślne dla desktopu\n        if (optTrimOnly) optTrimOnly.checked = true; // Prio domyślnie włączone\n        if (optCrop) optCrop.checked = false;        // Zwykłe kadrowanie wyłączone\n    }\n\n    // --- THEME SWITCH INIT ---\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    document.documentElement.setAttribute('data-theme', savedTheme);\n    \n    if(themeToggle) {\n        themeToggle.addEventListener('click', () => {\n            const current = document.documentElement.getAttribute('data-theme');\n            const next = current === 'light' ? 'dark' : 'light';\n            document.documentElement.setAttribute('data-theme', next);\n            localStorage.setItem('theme', next);\n            log(`Zmiana motywu na: ${next}`);\n        });\n    }\n\n    // --- OBSŁUGA DRAG & DROP ---\n    if(dropzone && fileInput) {\n        dropzone.addEventListener('click', () => {\n            console.log(\"Dropzone clicked\");\n            fileInput.click();\n        });\n\n        fileInput.addEventListener('change', (e) => {\n            addFiles(e.target.files);\n            fileInput.value = ''; \n        });\n\n        dropzone.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            dropzone.style.borderColor = 'var(--accent-color)';\n        });\n\n        dropzone.addEventListener('dragleave', (e) => {\n            e.preventDefault();\n            dropzone.style.borderColor = 'var(--border-color)';\n        });\n\n        dropzone.addEventListener('drop', (e) => {\n            e.preventDefault();\n            dropzone.style.borderColor = 'var(--border-color)';\n            addFiles(e.dataTransfer.files);\n        });\n    } else {\n        console.error(\"Brak elementu dropzone lub fileInput!\");\n    }\n\n    if(clearBtn) {\n        clearBtn.addEventListener('click', () => {\n            filesQueue = [];\n            renderList();\n            log('Lista wyczyszczona.');\n        });\n    }\n\n    // --- SANITYZACJA I SCHOWEK ---\n    if(baseNameInput) {\n        const updateFromClipboard = async () => {\n            try {\n                const text = await navigator.clipboard.readText();\n                if (text) {\n                    const cleanText = sanitizeName(text);\n                    // Aktualizuj jeśli tekst jest poprawny i inny niż obecny\n                    if (cleanText && baseNameInput.value !== cleanText) {\n                        baseNameInput.value = cleanText;\n                        baseNameInput.classList.add('flash-input');\n                        setTimeout(() => baseNameInput.classList.remove('flash-input'), 500);\n                        log(`Wklejono ze schowka: ${cleanText}`);\n                    }\n                }\n            } catch (err) {\n                // Ignoruj błędy (np. brak uprawnień)\n            }\n        };\n\n        // Reakcja na najechanie (standardowe działanie)\n        baseNameInput.addEventListener('mouseenter', updateFromClipboard);\n        \n        // Reakcja na kliknięcie (dla pewności/alternatywy)\n        baseNameInput.addEventListener('click', updateFromClipboard);\n        \n        // Reakcja na focus elementu (np. tabowanie)\n        baseNameInput.addEventListener('focus', updateFromClipboard);\n\n        // Reakcja na powrót do okna przeglądarki (jeśli mysz jest nad inputem)\n        window.addEventListener('focus', () => {\n            if (baseNameInput.matches(':hover')) {\n                updateFromClipboard();\n            }\n        });\n\n        baseNameInput.addEventListener('input', () => {\n            const original = baseNameInput.value;\n            const sanitized = sanitizeName(original);\n            if (original !== sanitized) {\n                baseNameInput.value = sanitized;\n            }\n        });\n    }\n\n    // --- WYKONANIE (UPLOAD) ---\n    if(executeBtn) {\n        executeBtn.addEventListener('click', async () => {\n            executeLogic();\n        });\n    }\n});\n\n// --- LOGOWANIE ---\nfunction log(message) {\n  if(!consoleLog) return;\n  const p = document.createElement('p');\n  p.textContent = `> ${message}`;\n  consoleLog.appendChild(p);\n  consoleLog.scrollTop = consoleLog.scrollHeight;\n}\n\n// --- SANITYZACJA ---\nconst sanitizeName = str => {\n  const map = {\n    'ą': 'a', 'ć': 'c', 'ę': 'e', 'ł': 'l', 'ń': 'n', 'ó': 'o', 'ś': 's', 'ź': 'z', 'ż': 'z',\n    'Ą': 'A', 'Ć': 'C', 'Ę': 'E', 'Ł': 'L', 'Ń': 'N', 'Ó': 'O', 'Ś': 'S', 'Ź': 'Z', 'Ż': 'Z'\n  };\n  let processed = str.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g, match => map[match]);\n  processed = processed.replace(/[^a-zA-Z0-9]/g, '-');\n  processed = processed.replace(/-+/g, '-');\n  processed = processed.replace(/^-+|-+$/g, '');\n  return processed;\n};\n\n// --- ZARZĄDZANIE PLIKAMI ---\n\nfunction renderList() {\n  if(!fileList) return;\n  fileList.innerHTML = '';\n  filesQueue.forEach((item, index) => {\n    const li = document.createElement('li');\n    li.className = 'file-item';\n    \n    // Checkbox\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.className = 'file-select';\n    checkbox.checked = item.selected;\n    checkbox.onchange = (e) => {\n        item.selected = e.target.checked;\n    };\n\n    // Info Name with Hover Preview\n    const span = document.createElement('span');\n    span.className = 'file-info';\n    span.textContent = `[${index + 1}] ${item.file.name} (${(item.file.size / 1024).toFixed(1)} KB) (${item.width}x${item.height} px)`;\n    \n    // Hover Eventy\n    span.addEventListener('mouseenter', (e) => showPreview(e, item.file));\n    span.addEventListener('mouseleave', hidePreview);\n    span.addEventListener('mousemove', movePreview); // Żeby tooltip chodził za myszką\n\n    // Controls\n    const divControls = document.createElement('div');\n    divControls.className = 'file-controls';\n    \n    divControls.innerHTML = `\n        <button class=\"btn btn-sm\" onclick=\"window.moveUp(${index})\">▲</button>\n        <button class=\"btn btn-sm\" onclick=\"window.moveDown(${index})\">▼</button>\n        <button class=\"btn btn-sm\" onclick=\"window.removeFile(${index})\" style=\"color:var(--error-color); border-color:var(--error-color);\">X</button>\n    `;\n\n    li.appendChild(checkbox);\n    li.appendChild(span);\n    li.appendChild(divControls);\n    fileList.appendChild(li);\n  });\n}\n\n// --- PODGLĄD ZDJĘĆ ---\nconst tooltip = document.getElementById('preview-tooltip');\n\nfunction showPreview(e, file) {\n    if(!tooltip) return;\n    \n    // Tworzymy URL tylko na chwilę\n    const url = URL.createObjectURL(file);\n    tooltip.innerHTML = `<img src=\"${url}\" alt=\"Preview\">`;\n    tooltip.style.display = 'block';\n    \n    // Pozycjonowanie wstępne\n    movePreview(e);\n}\n\nfunction movePreview(e) {\n    if(!tooltip) return;\n    // Przesunięcie o 15px żeby nie zasłaniać kursora\n    const x = e.clientX + 15;\n    const y = e.clientY + 15;\n    \n    // Sprawdzenie czy nie wychodzi poza ekran (proste)\n    tooltip.style.left = x + 'px';\n    tooltip.style.top = y + 'px';\n}\n\nfunction hidePreview() {\n    if(!tooltip) return;\n    tooltip.style.display = 'none';\n    tooltip.innerHTML = ''; // Czyścimy img żeby zwolnić pamięć (browser garbage collector)\n}\n\n\n// Helper do ładowania obrazu i pobierania wymiarów\nconst loadImageDimensions = (file) => {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => {\n      URL.revokeObjectURL(img.src); // Zwolnienie pamięci po załadowaniu\n      resolve({ width: img.width, height: img.height });\n    };\n    img.onerror = reject;\n    img.src = URL.createObjectURL(file);\n  });\n};\n\nasync function addFiles(files) { // <--- make it async\n  const filesToAdd = [];\n  for (const file of Array.from(files)) { // <--- use for...of for await\n    if (file.type.startsWith('image/')) {\n      try {\n        const { width, height } = await loadImageDimensions(file); // <--- await dimensions\n        filesToAdd.push({\n          file,\n          id: Date.now() + Math.random(),\n          selected: true,\n          width, // <--- add width\n          height // <--- add height\n        });\n        log(`Dodano: ${file.name} (${width}x${height} px)`);\n      } catch (error) {\n        log(`BŁĄD podczas wczytywania wymiarów pliku ${file.name}: ${error.message}`);\n      }\n    } else {\n      log(`BŁĄD: ${file.name} nie jest obrazem.`);\n    }\n  }\n  filesQueue.push(...filesToAdd); // <--- push all at once\n  renderList();\n}\n\n// Funkcje globalne\nwindow.moveUp = (index) => {\n  if (index > 0) {\n    [filesQueue[index - 1], filesQueue[index]] = [filesQueue[index], filesQueue[index - 1]];\n    renderList();\n  }\n};\n\nwindow.moveDown = (index) => {\n  if (index < filesQueue.length - 1) {\n    [filesQueue[index + 1], filesQueue[index]] = [filesQueue[index], filesQueue[index + 1]];\n    renderList();\n  }\n};\n\nwindow.removeFile = (index) => {\n  const targetItem = filesQueue[index];\n  \n  if (targetItem.selected) {\n      // GRUPOWE USUWANIE: Jeśli kliknięto na zaznaczony element, usuń WSZYSTKIE zaznaczone\n      const initialCount = filesQueue.length;\n      filesQueue = filesQueue.filter(item => !item.selected);\n      const removedCount = initialCount - filesQueue.length;\n      log(`Usunięto zaznaczone pliki: ${removedCount}`);\n  } else {\n      // POJEDYNCZE USUWANIE: Kliknięto na niezaznaczony element -> usuń tylko jego\n      log(`Usunięto: ${targetItem.file.name}`);\n      filesQueue.splice(index, 1);\n  }\n  renderList();\n};\n\n// Zaktualizowana funkcja executeLogic uwzględniająca TYLKO zaznaczone pliki\nasync function executeLogic() {\n  // Filtrowanie\n  const selectedFiles = filesQueue.filter(item => item.selected);\n\n  if (selectedFiles.length === 0) {\n    log('BŁĄD: Brak zaznaczonych plików do przetworzenia.');\n    return;\n  }\n\n  const baseName = baseNameInput.value.trim() || 'image';\n  const startNum = parseInt(startNumberInput.value) || 1;\n  const mode = processingModeSelect.value;\n\n  log(`Rozpoczynanie procedury dla ${selectedFiles.length} plików (${mode === 'local' ? 'LOKALNIE' : 'SERWER'})...`);\n\n  // --- TRYB ELECTRON (Desktop) ---\n  if (window.electronAPI) {\n      log('Wykryto środowisko Desktop (Electron). Używam natywnego przetwarzania...');\n      \n      // W Electronie obiekt File ma właściwość .path (pełna ścieżka)\n      const filePaths = selectedFiles.map(item => item.file.path);\n      \n      const options = { \n          baseName, \n          startNumber: startNum, \n          optCrop: optCrop.checked, \n          optTrimOnly: optTrimOnly.checked,\n          optAddMargin: optAddMargin.checked,\n          optResize: optResize.checked \n      };\n\n      // Rejestracja listenera logów (jeśli jeszcze nie dodany)\n      if (!window.electronLogListenerAdded) {\n          window.electronAPI.onLog((msg) => log(msg));\n          window.electronLogListenerAdded = true;\n      }\n\n      try {\n          const result = await window.electronAPI.processImages(filePaths, options);\n          if (result.success) {\n              log(`SUKCES: Zapisano w katalogu: ${result.path}`);\n          } else {\n              log(`BŁĄD: ${result.message}`);\n          }\n      } catch (e) {\n          log(`BŁĄD KRYTYCZNY: ${e.message}`);\n      }\n      return;\n  }\n\n  if (mode === 'local') {\n    const options = { \n      baseName, \n      startNumber: startNum, \n      optCrop: optCrop.checked, \n      optTrimOnly: optTrimOnly.checked,\n      optAddMargin: optAddMargin.checked,\n      optResize: optResize.checked \n    };\n\n    try {\n      const { processFilesClientSide } = await import('./client-processor.js');\n      // Przekazujemy tylko zaznaczone!\n      const zipBlob = await processFilesClientSide(selectedFiles, options, (msg) => log(msg));\n      \n      const url = window.URL.createObjectURL(zipBlob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'processed.zip';\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      log('SUKCES: Gotowe (Lokalnie).');\n    } catch (e) {\n      log(`BŁĄD LOKALNY: ${e.message}`);\n    }\n    return;\n  }\n\n  // SERVER MODE\n  const formData = new FormData();\n  selectedFiles.forEach((item) => {\n    formData.append('images', item.file);\n  });\n  formData.append('newName', baseName);\n  formData.append('startNumber', startNum);\n  formData.append('optCrop', optCrop.checked);\n  formData.append('optTrimOnly', optTrimOnly.checked);\n  formData.append('optAddMargin', optAddMargin.checked);\n  formData.append('optResize', optResize.checked);\n\n  try {\n    const API_URL = 'http://localhost:3000/upload-tools';\n    const response = await fetch(API_URL, { method: 'POST', body: formData });\n\n    if (response.ok) {\n      log('SUKCES: Pliki przetworzone.');\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'processed.zip';\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      log('Rozpoczęto pobieranie archiwum.');\n    } else {\n      const errText = await response.text();\n      log(`BŁĄD SERWERA: ${errText}`);\n    }\n  } catch (error) {\n    log(`BŁĄD SIECI: ${error.message}`);\n  }\n}\n"],"file":"tools.js"}
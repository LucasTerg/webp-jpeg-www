{"version":3,"file":"tools.js","sources":["../src/js/tools.js"],"sourcesContent":["let filesQueue = [];\n\n// Elementy DOM\nconst dropzone = document.getElementById('file-dropzone');\nconst fileInput = document.getElementById('file-input');\nconst fileList = document.getElementById('file-list');\nconst clearBtn = document.getElementById('clear-list');\nconst executeBtn = document.getElementById('execute-btn');\nconst consoleLog = document.getElementById('console-log');\nconst themeToggle = document.getElementById('theme-toggle');\n\n// Ustawienia\nconst baseNameInput = document.getElementById('base-name');\nconst startNumberInput = document.getElementById('start-number');\nconst optCrop = document.getElementById('opt-crop');\nconst optResize = document.getElementById('opt-resize');\nconst optBgRemove = document.getElementById('opt-bg-remove'); // Obecnie działa jak crop+flag\n\n// --- LOGOWANIE ---\nfunction log(message) {\n  const p = document.createElement('p');\n  p.textContent = `> ${message}`;\n  consoleLog.appendChild(p);\n  consoleLog.scrollTop = consoleLog.scrollHeight;\n}\n\n// --- SANITYZACJA I SCHOWEK ---\nconst sanitizeName = str => {\n  const map = {\n    'ą': 'a', 'ć': 'c', 'ę': 'e', 'ł': 'l', 'ń': 'n', 'ó': 'o', 'ś': 's', 'ź': 'z', 'ż': 'z',\n    'Ą': 'A', 'Ć': 'C', 'Ę': 'E', 'Ł': 'L', 'Ń': 'N', 'Ó': 'O', 'Ś': 'S', 'Ź': 'Z', 'Ż': 'Z'\n  };\n  let processed = str.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g, match => map[match]);\n  processed = processed.replace(/[^a-zA-Z0-9]/g, '-');\n  processed = processed.replace(/-+/g, '-');\n  processed = processed.replace(/^-+|-+$/g, '');\n  return processed;\n};\n\nbaseNameInput.addEventListener('mouseenter', async () => {\n  if (baseNameInput.value.trim() !== '') return; // Nie nadpisuj, jeśli coś jest wpisane\n\n  try {\n    const text = await navigator.clipboard.readText();\n    if (text) {\n      const cleanText = sanitizeName(text);\n      if (cleanText) {\n        baseNameInput.value = cleanText;\n        baseNameInput.classList.add('flash-input'); // Opcjonalny efekt wizualny\n        setTimeout(() => baseNameInput.classList.remove('flash-input'), 500);\n        log(`Wklejono ze schowka: ${cleanText}`);\n      }\n    }\n  } catch (err) {\n    // Ignoruj błędy (np. brak fokusu, brak uprawnień), żeby nie spamować, \n    // ale można zalogować raz\n    // log('Info: Nie można odczytać schowka (brak uprawnień?).');\n  }\n});\n\nbaseNameInput.addEventListener('input', () => {\n  const original = baseNameInput.value;\n  const sanitized = sanitizeName(original);\n  if (original !== sanitized) {\n    baseNameInput.value = sanitized;\n  }\n});\n\n// --- ZARZĄDZANIE PLIKAMI ---\n\nfunction renderList() {\n  fileList.innerHTML = '';\n  filesQueue.forEach((item, index) => {\n    const li = document.createElement('li');\n    li.className = 'file-item';\n    \n    li.innerHTML = `\n      <span class=\"file-info\">[${index + 1}] ${item.file.name} (${(item.file.size / 1024).toFixed(1)} KB)</span>\n      <div class=\"file-controls\">\n        <button class=\"btn btn-sm\" onclick=\"window.moveUp(${index})\">▲</button>\n        <button class=\"btn btn-sm\" onclick=\"window.moveDown(${index})\">▼</button>\n        <button class=\"btn btn-sm\" onclick=\"window.removeFile(${index})\" style=\"color:var(--error-color); border-color:var(--error-color);\">X</button>\n      </div>\n    `;\n    fileList.appendChild(li);\n  });\n}\n\nfunction addFiles(files) {\n  Array.from(files).forEach(file => {\n    // Prosta walidacja typu\n    if (file.type.startsWith('image/')) {\n      filesQueue.push({ file, id: Date.now() + Math.random() });\n      log(`Dodano: ${file.name}`);\n    } else {\n      log(`BŁĄD: ${file.name} nie jest obrazem.`);\n    }\n  });\n  renderList();\n}\n\n// Funkcje globalne (dla onclick w HTML)\nwindow.moveUp = (index) => {\n  if (index > 0) {\n    [filesQueue[index - 1], filesQueue[index]] = [filesQueue[index], filesQueue[index - 1]];\n    renderList();\n  }\n};\n\nwindow.moveDown = (index) => {\n  if (index < filesQueue.length - 1) {\n    [filesQueue[index + 1], filesQueue[index]] = [filesQueue[index], filesQueue[index + 1]];\n    renderList();\n  }\n};\n\nwindow.removeFile = (index) => {\n  log(`Usunięto: ${filesQueue[index].file.name}`);\n  filesQueue.splice(index, 1);\n  renderList();\n};\n\n// --- OBSŁUGA DRAG & DROP ---\n\ndropzone.addEventListener('click', () => fileInput.click());\n\nfileInput.addEventListener('change', (e) => {\n  addFiles(e.target.files);\n  fileInput.value = ''; // Reset inputa\n});\n\ndropzone.addEventListener('dragover', (e) => {\n  e.preventDefault();\n  dropzone.style.borderColor = 'var(--accent-color)';\n});\n\ndropzone.addEventListener('dragleave', (e) => {\n  e.preventDefault();\n  dropzone.style.borderColor = 'var(--border-color)';\n});\n\ndropzone.addEventListener('drop', (e) => {\n  e.preventDefault();\n  dropzone.style.borderColor = 'var(--border-color)';\n  addFiles(e.dataTransfer.files);\n});\n\nclearBtn.addEventListener('click', () => {\n  filesQueue = [];\n  renderList();\n  log('Lista wyczyszczona.');\n});\n\n// --- WYKONANIE (UPLOAD) ---\n\nexecuteBtn.addEventListener('click', async () => {\n  if (filesQueue.length === 0) {\n    log('BŁĄD: Brak plików do przetworzenia.');\n    return;\n  }\n\n  const baseName = baseNameInput.value.trim() || 'image';\n  const startNum = parseInt(startNumberInput.value) || 1;\n\n  log('Rozpoczynanie procedury uploadu...');\n  \n  const formData = new FormData();\n  \n  // Dodajemy pliki w kolejności z listy\n  filesQueue.forEach((item) => {\n    formData.append('images', item.file);\n  });\n\n  // Dodajemy parametry konfiguracyjne\n  formData.append('newName', baseName);\n  formData.append('startNumber', startNum);\n  formData.append('optCrop', optCrop.checked);\n  formData.append('optResize', optResize.checked);\n  // formData.append('optBgRemove', optBgRemove.checked); // Na razie tożsame z crop w naszej logice serwera, ale wyślemy\n\n  try {\n    // Zakładam, że serwer nasłuchuje na porcie 3000 (lokalnie) lub relatywnie\n    const API_URL = 'http://localhost:3000/upload-tools'; // Nowy endpoint dla narzędzi\n    \n    const response = await fetch(API_URL, {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (response.ok) {\n      log('SUKCES: Pliki przetworzone.');\n      \n      // Pobieranie bloba (ZIP)\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'processed.zip';\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      log('Rozpoczęto pobieranie archiwum.');\n    } else {\n      const errText = await response.text();\n      log(`BŁĄD SERWERA: ${errText}`);\n    }\n  } catch (error) {\n    log(`BŁĄD SIECI: ${error.message}`);\n  }\n});\n\n// --- THEME SWITCH ---\n// Inicjalizacja motywu\nconst savedTheme = localStorage.getItem('theme') || 'dark';\ndocument.documentElement.setAttribute('data-theme', savedTheme);\n\nthemeToggle.addEventListener('click', () => {\n  const current = document.documentElement.getAttribute('data-theme');\n  const next = current === 'light' ? 'dark' : 'light';\n  document.documentElement.setAttribute('data-theme', next);\n  localStorage.setItem('theme', next);\n  log(`Zmiana motywu na: ${next}`);\n});\n"],"names":["filesQueue","dropzone","fileInput","fileList","clearBtn","executeBtn","consoleLog","themeToggle","baseNameInput","startNumberInput","optCrop","optResize","log","message","p","sanitizeName","str","map","processed","match","text","cleanText","original","sanitized","renderList","item","index","li","addFiles","files","file","baseName","startNum","formData","response","blob","url","a","errText","error","savedTheme","next"],"mappings":"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"}
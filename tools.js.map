{"version":3,"mappings":"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","names":["filesQueue","truncateFileName","name","maxLength","parts","extension","baseName","startChars","endChars","dropzone","fileInput","fileList","clearBtn","executeBtn","consoleLog","themeToggle","processingModeSelect","baseNameInput","startNumberInput","optAddMargin","optResize","optOverwrite","modeSmart","modeSimple","modeNone","log","savedTheme","next","e","addFiles","renderList","updateFromClipboard","text","cleanText","sanitizeName","original","sanitized","executeLogic","message","p","str","map","processed","match","item","index","li","checkbox","span","displayedFileName","showPreview","hidePreview","movePreview","divControls","tooltip","file","url","x","y","loadImageDimensions","resolve","reject","img","files","filesToAdd","width","height","error","targetItem","initialCount","removedCount","selectedFiles","startNum","mode","isSmart","isSimple","optCropValue","optTrimOnlyValue","filePaths","path","options","msg","result","processFilesClientSide","__vitePreload","zipBlob","a"],"ignoreList":[],"sources":["../src/js/tools.js"],"sourcesContent":["// import { processFilesClientSide } from './client-processor.js'; // USUNIĘTE (Dynamic import poniżej)\n\n// alert(\"Tools script loaded!\");\n\nlet filesQueue = [];\n\n// --- HELPER: SKRACANIE NAZWY PLIKU ---\nconst truncateFileName = (name, maxLength = 18) => {\n  if (name.length <= maxLength) return name;\n  \n  const parts = name.split('.');\n  const extension = parts.length > 1 ? `.${parts.pop()}` : '';\n  const baseName = parts.join('.');\n  \n  const startChars = 8; \n  const endChars = 6; \n  \n  if (baseName.length <= startChars) {\n      return `${baseName.substring(0, startChars)}...${extension}`;\n  }\n\n  return `${baseName.substring(0, startChars)}...${baseName.substring(baseName.length - endChars)}${extension}`;\n};\n\n\nlet dropzone, fileInput, fileList, clearBtn, executeBtn, consoleLog, themeToggle, processingModeSelect, baseNameInput, startNumberInput;\n// Nowe kontrolki\nlet optAddMargin, optResize, optOverwrite;\nlet modeSmart, modeSimple, modeNone;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    console.log(\"DOM Loaded - initializing Tools\");\n\n    // Elementy DOM\n    dropzone = document.getElementById('file-dropzone');\n    fileInput = document.getElementById('file-input');\n    fileList = document.getElementById('file-list');\n    clearBtn = document.getElementById('clear-list');\n    executeBtn = document.getElementById('execute-btn');\n    consoleLog = document.getElementById('console-log');\n    themeToggle = document.getElementById('theme-toggle');\n    processingModeSelect = document.getElementById('processing-mode');\n\n    // Ustawienia\n    baseNameInput = document.getElementById('base-name');\n    startNumberInput = document.getElementById('start-number');\n    \n    // Nowe Radio Buttons\n    modeSmart = document.getElementById('mode-smart');\n    modeSimple = document.getElementById('mode-simple');\n    modeNone = document.getElementById('mode-none');\n\n    // Checkboxy Post-process\n    optAddMargin = document.getElementById('opt-add-margin');\n    optResize = document.getElementById('opt-resize');\n    optOverwrite = document.getElementById('opt-overwrite');\n\n    // --- DETEKCJA ELECTRONA (Desktop) ---\n    if (window.electronAPI) {\n        document.body.classList.add('is-electron');\n        log('Tryb Desktop (Electron) aktywny.');\n        \n        // Ustawienia domyślne dla desktopu\n        // Domyślnie zaznaczony w HTML jest modeSimple, więc tu nic nie musimy robić\n    }\n\n    // --- THEME SWITCH INIT ---\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    document.documentElement.setAttribute('data-theme', savedTheme);\n    \n    if(themeToggle) {\n        themeToggle.addEventListener('click', () => {\n            const current = document.documentElement.getAttribute('data-theme');\n            const next = current === 'light' ? 'dark' : 'light';\n            document.documentElement.setAttribute('data-theme', next);\n            localStorage.setItem('theme', next);\n            log(`Zmiana motywu na: ${next}`);\n        });\n    }\n\n    // --- OBSŁUGA DRAG & DROP ---\n    if(dropzone && fileInput) {\n        dropzone.addEventListener('click', () => {\n            console.log(\"Dropzone clicked\");\n            fileInput.click();\n        });\n\n        fileInput.addEventListener('change', (e) => {\n            addFiles(e.target.files);\n            fileInput.value = ''; \n        });\n\n        dropzone.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            dropzone.style.borderColor = 'var(--accent-color)';\n        });\n\n        dropzone.addEventListener('dragleave', (e) => {\n            e.preventDefault();\n            dropzone.style.borderColor = 'var(--border-color)';\n        });\n\n        dropzone.addEventListener('drop', (e) => {\n            e.preventDefault();\n            dropzone.style.borderColor = 'var(--border-color)';\n            addFiles(e.dataTransfer.files);\n        });\n    } else {\n        console.error(\"Brak elementu dropzone lub fileInput!\");\n    }\n\n    if(clearBtn) {\n        clearBtn.addEventListener('click', () => {\n            filesQueue = [];\n            renderList();\n            log('Lista wyczyszczona.');\n        });\n    }\n\n    // --- SANITYZACJA I SCHOWEK ---\n    if(baseNameInput) {\n        const updateFromClipboard = async () => {\n            try {\n                const text = await navigator.clipboard.readText();\n                if (text) {\n                    const cleanText = sanitizeName(text);\n                    // Aktualizuj jeśli tekst jest poprawny i inny niż obecny\n                    if (cleanText && baseNameInput.value !== cleanText) {\n                        baseNameInput.value = cleanText;\n                        baseNameInput.classList.add('flash-input');\n                        setTimeout(() => baseNameInput.classList.remove('flash-input'), 500);\n                        log(`Wklejono ze schowka: ${cleanText}`);\n                    }\n                }\n            } catch (err) {\n                // Ignoruj błędy (np. brak uprawnień)\n            }\n        };\n\n        // Reakcja na najechanie (standardowe działanie)\n        baseNameInput.addEventListener('mouseenter', updateFromClipboard);\n        // baseNameInput.addEventListener('click', updateFromClipboard); // Wyłączone bo denerwuje przy edycji\n        baseNameInput.addEventListener('focus', updateFromClipboard);\n\n        window.addEventListener('focus', () => {\n            if (baseNameInput.matches(':hover')) {\n                updateFromClipboard();\n            }\n        });\n\n        baseNameInput.addEventListener('input', () => {\n            const original = baseNameInput.value;\n            const sanitized = sanitizeName(original);\n            if (original !== sanitized) {\n                baseNameInput.value = sanitized;\n            }\n        });\n    }\n\n    // --- WYKONANIE (UPLOAD) ---\n    if(executeBtn) {\n        executeBtn.addEventListener('click', async () => {\n            executeLogic();\n        });\n    }\n});\n\n// --- LOGOWANIE ---\nfunction log(message) {\n  if(!consoleLog) return;\n  const p = document.createElement('p');\n  p.textContent = `> ${message}`;\n  consoleLog.appendChild(p);\n  consoleLog.scrollTop = consoleLog.scrollHeight;\n}\n\n// --- SANITYZACJA ---\nconst sanitizeName = str => {\n  const map = {\n    'ą': 'a', 'ć': 'c', 'ę': 'e', 'ł': 'l', 'ń': 'n', 'ó': 'o', 'ś': 's', 'ź': 'z', 'ż': 'z',\n    'Ą': 'A', 'Ć': 'C', 'Ę': 'E', 'Ł': 'L', 'Ń': 'N', 'Ó': 'O', 'Ś': 'S', 'Ź': 'Z', 'Ż': 'Z'\n  };\n  let processed = str.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g, match => map[match]);\n  processed = processed.replace(/[^a-zA-Z0-9]/g, '-');\n  processed = processed.replace(/-+/g, '-');\n  processed = processed.replace(/^-+|-+$/g, '');\n  return processed;\n};\n\n// --- ZARZĄDZANIE PLIKAMI ---\n\nfunction renderList() {\n  if(!fileList) return;\n  fileList.innerHTML = '';\n  filesQueue.forEach((item, index) => {\n    const li = document.createElement('li');\n    li.className = 'file-item';\n    \n    // Checkbox\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.className = 'file-select';\n    checkbox.checked = item.selected;\n    checkbox.onchange = (e) => {\n        item.selected = e.target.checked;\n    };\n\n    // Info Name with Hover Preview\n    const span = document.createElement('span');\n    span.className = 'file-info';\n    const displayedFileName = truncateFileName(item.file.name); \n    span.textContent = `[${index + 1}] ${displayedFileName} (${(item.file.size / 1024).toFixed(1)} KB) (${item.width}x${item.height} px)`;\n    span.title = item.file.name;\n    \n    // Hover Eventy\n    span.addEventListener('mouseenter', (e) => showPreview(e, item.file));\n    span.addEventListener('mouseleave', hidePreview);\n    span.addEventListener('mousemove', movePreview);\n\n    // Controls\n    const divControls = document.createElement('div');\n    divControls.className = 'file-controls';\n    \n    divControls.innerHTML = `\n        <button class=\"btn btn-sm\" onclick=\"window.moveUp(${index})\">▲</button>\n        <button class=\"btn btn-sm\" onclick=\"window.moveDown(${index})\">▼</button>\n        <button class=\"btn btn-sm\" onclick=\"window.removeFile(${index})\" style=\"color:var(--error-color); border-color:var(--error-color);\">X</button>\n    `;\n\n    li.appendChild(checkbox);\n    li.appendChild(span);\n    li.appendChild(divControls);\n    fileList.appendChild(li);\n  });\n}\n\n// --- PODGLĄD ZDJĘĆ ---\nconst tooltip = document.getElementById('preview-tooltip');\n\nfunction showPreview(e, file) {\n    if(!tooltip) return;\n    \n    const url = URL.createObjectURL(file);\n    tooltip.innerHTML = `<img src=\"${url}\" alt=\"Preview\">`;\n    tooltip.style.display = 'block';\n    \n    movePreview(e);\n}\n\nfunction movePreview(e) {\n    if(!tooltip) return;\n    const x = e.clientX + 15;\n    const y = e.clientY + 15;\n    \n    tooltip.style.left = x + 'px';\n    tooltip.style.top = y + 'px';\n}\n\nfunction hidePreview() {\n    if(!tooltip) return;\n    tooltip.style.display = 'none';\n    tooltip.innerHTML = '';\n}\n\n\nconst loadImageDimensions = (file) => {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => {\n      URL.revokeObjectURL(img.src);\n      resolve({ width: img.width, height: img.height });\n    };\n    img.onerror = reject;\n    img.src = URL.createObjectURL(file);\n  });\n};\n\nasync function addFiles(files) {\n  const filesToAdd = [];\n  for (const file of Array.from(files)) {\n    if (file.type.startsWith('image/')) {\n      try {\n        const { width, height } = await loadImageDimensions(file);\n        filesToAdd.push({\n          file,\n          id: Date.now() + Math.random(),\n          selected: true,\n          width, \n          height\n        });\n        log(`Dodano: ${file.name} (${width}x${height} px)`);\n      } catch (error) {\n        log(`BŁĄD podczas wczytywania wymiarów pliku ${file.name}: ${error.message}`);\n      }\n    } else {\n      log(`BŁĄD: ${file.name} nie jest obrazem.`);\n    }\n  }\n  filesQueue.push(...filesToAdd);\n  renderList();\n}\n\nwindow.moveUp = (index) => {\n  if (index > 0) {\n    [filesQueue[index - 1], filesQueue[index]] = [filesQueue[index], filesQueue[index - 1]];\n    renderList();\n  }\n};\n\nwindow.moveDown = (index) => {\n  if (index < filesQueue.length - 1) {\n    [filesQueue[index + 1], filesQueue[index]] = [filesQueue[index], filesQueue[index + 1]];\n    renderList();\n  }\n};\n\nwindow.removeFile = (index) => {\n  const targetItem = filesQueue[index];\n  \n  if (targetItem.selected) {\n      const initialCount = filesQueue.length;\n      filesQueue = filesQueue.filter(item => !item.selected);\n      const removedCount = initialCount - filesQueue.length;\n      log(`Usunięto zaznaczone pliki: ${removedCount}`);\n  } else {\n      log(`Usunięto: ${targetItem.file.name}`);\n      filesQueue.splice(index, 1);\n  }\n  renderList();\n};\n\n// Zaktualizowana funkcja executeLogic\nasync function executeLogic() {\n  const selectedFiles = filesQueue.filter(item => item.selected);\n\n  if (selectedFiles.length === 0) {\n    log('BŁĄD: Brak zaznaczonych plików do przetworzenia.');\n    return;\n  }\n\n  const baseName = baseNameInput.value.trim() || 'image';\n  const startNum = parseInt(startNumberInput.value) || 1;\n  const mode = processingModeSelect.value;\n\n  // Ustalanie flag na podstawie Radio Buttons\n  const isSmart = modeSmart.checked;\n  const isSimple = modeSimple.checked;\n  const isNone = modeNone.checked;\n\n  // Mapowanie na stare flagi\n  const optCropValue = isSmart;\n  const optTrimOnlyValue = isSimple;\n  // isNone = false i false\n\n  log(`Rozpoczynanie procedury dla ${selectedFiles.length} plików...`);\n\n  // --- TRYB ELECTRON (Desktop) ---\n  if (window.electronAPI) {\n      log('Wykryto środowisko Desktop (Electron). Używam natywnego przetwarzania...');\n      \n      let filePaths = selectedFiles.map(item => {\n          let path = null;\n          if (window.electronAPI.getPathForFile) {\n              path = window.electronAPI.getPathForFile(item.file);\n          }\n          if (!path) path = item.file.path;\n\n          if (!path) {\n              log(`OSTRZEŻENIE: Brak ścieżki dla pliku: ${item.file.name}. Sprawdź uprawnienia lub metodę dodawania.`);\n              return null; \n          }\n          return path;\n      }).filter(path => path !== null);\n\n      if (filePaths.length === 0) {\n          log('BŁĄD: Nie udało się pobrać ścieżek plików. Operacja przerwana.');\n          return;\n      }\n      \n      log(`Wysyłanie ${filePaths.length} plików do procesu głównego...`);\n      \n      const options = { \n          baseName, \n          startNumber: startNum, \n          optCrop: optCropValue, \n          optTrimOnly: optTrimOnlyValue,\n          optAddMargin: optAddMargin.checked,\n          optResize: optResize.checked,\n          optOverwrite: optOverwrite.checked // Nowa opcja\n      };\n\n      if (!window.electronLogListenerAdded) {\n          window.electronAPI.onLog((msg) => log(msg));\n          window.electronLogListenerAdded = true;\n      }\n\n      try {\n          const result = await window.electronAPI.processImages(filePaths, options);\n          if (result.success) {\n              log(`SUKCES: Zapisano w katalogu: ${result.path}`);\n          } else {\n              log(`BŁĄD: ${result.message}`);\n          }\n      } catch (e) {\n          log(`BŁĄD KRYTYCZNY: ${e.message}`);\n      }\n      return;\n  }\n\n  // --- TRYB LOCAL (Web) - Tutaj mamy mniejsze możliwości ---\n  if (mode === 'local') {\n    log('Tryb WEB (Lokalny) - start przetwarzania...');\n    const options = { \n      baseName, \n      startNumber: startNum, \n      optCrop: optCropValue, \n      optTrimOnly: optTrimOnlyValue,\n      optAddMargin: optAddMargin.checked,\n      optResize: optResize.checked \n    };\n\n    try {\n      const { processFilesClientSide } = await import('./client-processor.js');\n      const zipBlob = await processFilesClientSide(selectedFiles, options, (msg) => log(msg));\n      \n      const url = window.URL.createObjectURL(zipBlob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'processed.zip';\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      log('SUKCES: Gotowe (Lokalnie).');\n    } catch (e) {\n      log(`BŁĄD LOKALNY: ${e.message}`);\n    }\n    return;\n  }\n\n  // SERVER MODE (Dla kompatybilności, ale w Electronie nie używany)\n  // ... (pomijam kod serwera webowego, bo w Electronie go nie używamy)\n}\n"],"file":"tools.js"}
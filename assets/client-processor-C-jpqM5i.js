import{J as D}from"./vendor-C_Uzxf6_.js";console.log("Client processor module loaded");const F=u=>new Promise((l,d)=>{const e=new Image;e.onload=()=>l(e),e.onerror=d,e.src=URL.createObjectURL(u)}),J=(u,l,d)=>{const e=u.getImageData(0,0,l,d).data;let f=0,w=d,m=0,x=l;const y=(c,a,n,p)=>{const R=c>230&&a>230&&n>230,I=p<255;return R||I};for(f=0;f<d;f++){let c=!1;for(let a=0;a<l;a++){const n=(f*l+a)*4;if(!y(e[n],e[n+1],e[n+2],e[n+3])){c=!0;break}}if(c)break}if(f===d)return null;for(w=d-1;w>=f;w--){let c=!1;for(let a=0;a<l;a++){const n=(w*l+a)*4;if(!y(e[n],e[n+1],e[n+2],e[n+3])){c=!0;break}}if(c)break}for(m=0;m<l;m++){let c=!1;for(let a=f;a<=w;a++){const n=(a*l+m)*4;if(!y(e[n],e[n+1],e[n+2],e[n+3])){c=!0;break}}if(c)break}for(x=l-1;x>=m;x--){let c=!1;for(let a=f;a<=w;a++){const n=(a*l+x)*4;if(!y(e[n],e[n+1],e[n+2],e[n+3])){c=!0;break}}if(c)break}return{x:m,y:f,width:x-m+1,height:w-f+1}},X=async(u,l,d)=>{const e=new D,{baseName:f,startNumber:w,optCrop:m,optTrimOnly:x,optAddMargin:y,optResize:c}=l;let a=0;for(let p=0;p<u.length;p++){const I=u[p].file;d&&d(`Przetwarzanie: ${I.name} (${p+1}/${u.length})`);try{const h=await F(I);let t=document.createElement("canvas");t.width=h.width,t.height=h.height;let b=t.getContext("2d",{willReadFrequently:!0});b.drawImage(h,0,0);let H=!1;if(m||x){const i=[{x:0,y:0},{x:h.width-1,y:0},{x:0,y:h.height-1},{x:h.width-1,y:h.height-1}],r=b.getImageData(0,0,h.width,h.height).data;for(let s of i){const g=(s.y*h.width+s.x)*4,C=r[g],v=r[g+1],N=r[g+2],T=r[g+3];if(C>230&&v>230&&N>230||T<255){H=!0;break}}const o=J(b,t.width,t.height);if(o){(o.width<t.width||o.height<t.height)&&(H=!0);const s=document.createElement("canvas");s.width=o.width,s.height=o.height;const g=s.getContext("2d");g.drawImage(t,o.x,o.y,o.width,o.height,0,0,o.width,o.height),t=s,b=g}}const E=3e3,W=3600,$=m&&!x&&H||y,k=$?10:0;let z=t.width,A=t.height;if(z+k>E||A+k>W){const i=E-k,r=W-k,o=Math.min(i/z,r/A),s=Math.floor(z*o),g=Math.floor(A*o),C=document.createElement("canvas");C.width=s,C.height=g;const v=C.getContext("2d");v.drawImage(t,0,0,s,g),t=C,b=v}if($){const i=document.createElement("canvas");i.width=t.width+10,i.height=t.height+10;const r=i.getContext("2d");r.fillStyle="#ffffff",r.fillRect(0,0,i.width,i.height),r.drawImage(t,5,5),t=i,b=r}if(c){const i=Math.max(t.width,500),r=Math.max(t.height,500);if(t.width<i||t.height<r){const o=document.createElement("canvas");o.width=i,o.height=r;const s=o.getContext("2d");s.fillStyle="#ffffff",s.fillRect(0,0,i,r);const g=Math.floor((i-t.width)/2),C=Math.floor((r-t.height)/2);s.drawImage(t,g,C),t=o,b=s}}const M=document.createElement("canvas");M.width=t.width,M.height=t.height;const B=M.getContext("2d");B.fillStyle="#ffffff",B.fillRect(0,0,M.width,M.height),B.drawImage(t,0,0);const S=await new Promise(i=>M.toBlob(i,"image/jpeg",.99)),j=`${f}-${w+p}.jpg`;e.file(j,S),a++}catch(h){console.error("Błąd przetwarzania klienta:",h),d&&d(`Błąd: ${I.name}`)}}return d&&d("Pakowanie ZIP..."),await e.generateAsync({type:"blob"})};export{X as processFilesClientSide};
//# sourceMappingURL=client-processor-C-jpqM5i.js.map

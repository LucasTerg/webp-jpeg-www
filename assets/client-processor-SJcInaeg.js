import{J as H}from"./vendor-C_Uzxf6_.js";console.log("Client processor module loaded");const M=x=>new Promise((r,c)=>{const e=new Image;e.onload=()=>r(e),e.onerror=c,e.src=URL.createObjectURL(x)}),S=(x,r,c)=>{const e=x.getImageData(0,0,r,c).data;let h=0,m=c,g=0,b=r;const p=(l,a,n,y)=>{const s=l>230&&a>230&&n>230,t=y<255;return s||t};for(h=0;h<c;h++){let l=!1;for(let a=0;a<r;a++){const n=(h*r+a)*4;if(!p(e[n],e[n+1],e[n+2],e[n+3])){l=!0;break}}if(l)break}if(h===c)return null;for(m=c-1;m>=h;m--){let l=!1;for(let a=0;a<r;a++){const n=(m*r+a)*4;if(!p(e[n],e[n+1],e[n+2],e[n+3])){l=!0;break}}if(l)break}for(g=0;g<r;g++){let l=!1;for(let a=h;a<=m;a++){const n=(a*r+g)*4;if(!p(e[n],e[n+1],e[n+2],e[n+3])){l=!0;break}}if(l)break}for(b=r-1;b>=g;b--){let l=!1;for(let a=h;a<=m;a++){const n=(a*r+b)*4;if(!p(e[n],e[n+1],e[n+2],e[n+3])){l=!0;break}}if(l)break}return{x:g,y:h,width:b-g+1,height:m-h+1}},N=async(x,r,c)=>{const e=new H,{baseName:h,startNumber:m,optCrop:g,optResize:b}=r;let p=0;for(let a=0;a<x.length;a++){const y=x[a].file;c&&c(`Przetwarzanie: ${y.name} (${a+1}/${x.length})`);try{const s=await M(y);let t=document.createElement("canvas");t.width=s.width,t.height=s.height;let u=t.getContext("2d",{willReadFrequently:!0});u.drawImage(s,0,0);let k=!1;if(g){const o=[{x:0,y:0},{x:s.width-1,y:0},{x:0,y:s.height-1},{x:s.width-1,y:s.height-1}],f=u.getImageData(0,0,s.width,s.height).data;for(let d of o){const w=(d.y*s.width+d.x)*4,v=f[w],R=f[w+1],$=f[w+2],E=f[w+3];if(v>230&&R>230&&$>230||E<255){k=!0;break}}const i=S(u,t.width,t.height);if(i){(i.width<t.width||i.height<t.height)&&(k=!0);const d=document.createElement("canvas");d.width=i.width,d.height=i.height;const w=d.getContext("2d");w.drawImage(t,i.x,i.y,i.width,i.height,0,0,i.width,i.height),t=d,u=w}}if(g&&k){const o=document.createElement("canvas");o.width=t.width+10,o.height=t.height+10;const f=o.getContext("2d");f.fillStyle="#ffffff",f.fillRect(0,0,o.width,o.height),f.drawImage(t,5,5),t=o,u=f}if(b){const o=Math.max(t.width,500),f=Math.max(t.height,500);if(t.width<o||t.height<f){const i=document.createElement("canvas");i.width=o,i.height=f;const d=i.getContext("2d");d.fillStyle="#ffffff",d.fillRect(0,0,o,f);const w=Math.floor((o-t.width)/2),v=Math.floor((f-t.height)/2);d.drawImage(t,w,v),t=i,u=d}}const C=document.createElement("canvas");C.width=t.width,C.height=t.height;const I=C.getContext("2d");I.fillStyle="#ffffff",I.fillRect(0,0,C.width,C.height),I.drawImage(t,0,0);const z=await new Promise(o=>C.toBlob(o,"image/jpeg",.99)),B=`${h}-${m+a}.jpg`;e.file(B,z),p++}catch(s){console.error("Błąd przetwarzania klienta:",s),c&&c(`Błąd: ${y.name}`)}}return c&&c("Pakowanie ZIP..."),await e.generateAsync({type:"blob"})};export{N as processFilesClientSide};
//# sourceMappingURL=client-processor-SJcInaeg.js.map

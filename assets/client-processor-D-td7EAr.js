import{J}from"./vendor-C_Uzxf6_.js";console.log("Client processor module loaded");const L=C=>new Promise((c,s)=>{const e=new Image;e.onload=()=>c(e),e.onerror=s,e.src=URL.createObjectURL(C)}),O=(C,c,s)=>{const e=C.getImageData(0,0,c,s).data;let d=0,m=s,g=0,w=c;const y=(r,i,a,p)=>{const z=r>230&&i>230&&a>230,I=p<255;return z||I};for(d=0;d<s;d++){let r=!1;for(let i=0;i<c;i++){const a=(d*c+i)*4;if(!y(e[a],e[a+1],e[a+2],e[a+3])){r=!0;break}}if(r)break}if(d===s)return null;for(m=s-1;m>=d;m--){let r=!1;for(let i=0;i<c;i++){const a=(m*c+i)*4;if(!y(e[a],e[a+1],e[a+2],e[a+3])){r=!0;break}}if(r)break}for(g=0;g<c;g++){let r=!1;for(let i=d;i<=m;i++){const a=(i*c+g)*4;if(!y(e[a],e[a+1],e[a+2],e[a+3])){r=!0;break}}if(r)break}for(w=c-1;w>=g;w--){let r=!1;for(let i=d;i<=m;i++){const a=(i*c+w)*4;if(!y(e[a],e[a+1],e[a+2],e[a+3])){r=!0;break}}if(r)break}return{x:g,y:d,width:w-g+1,height:m-d+1}},_=async(C,c,s)=>{const e=new J,{baseName:d,startNumber:m,optCrop:g,optTrimOnly:w,optAddMargin:y,optResize:r}=c;let i=0;for(let p=0;p<C.length;p++){const I=C[p].file;s&&s(`Przetwarzanie: ${I.name} (${p+1}/${C.length})`);try{const h=await L(I);let o=document.createElement("canvas");o.width=h.width,o.height=h.height;let b=o.getContext("2d",{willReadFrequently:!0});b.drawImage(h,0,0);let B=!1,R=!1;if(g||w){const t=[{x:0,y:0},{x:h.width-1,y:0},{x:0,y:h.height-1},{x:h.width-1,y:h.height-1}],n=b.getImageData(0,0,h.width,h.height).data;for(let l of t){const f=(l.y*h.width+l.x)*4,k=n[f],H=n[f+1],D=n[f+2],F=n[f+3];if(k>230&&H>230&&D>230||F<255){B=!0;break}}}if(g||w){const t=O(b,o.width,o.height);if(t){(t.width<o.width||t.height<o.height)&&(R=!0);const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const l=n.getContext("2d");l.drawImage(o,t.x,t.y,t.width,t.height,0,0,t.width,t.height),o=n,b=l}}const E=g&&!w&&(B||R)||y,W=E?10:0,S=3e3,T=3600,$=S-W,A=T-W;let x=o.width,u=o.height;if(x>$||u>A){const t=Math.min($/x,A/u),n=Math.floor(x*t),l=Math.floor(u*t),f=document.createElement("canvas");f.width=n,f.height=l;const k=f.getContext("2d");k.drawImage(o,0,0,n,l),o=f,b=k,x=n,u=l}if(E){const t=document.createElement("canvas");t.width=x+10,t.height=u+10;const n=t.getContext("2d");n.fillStyle="#ffffff",n.fillRect(0,0,t.width,t.height),n.drawImage(o,5,5),o=t,b=n,x+=10,u+=10}if(r){const t=Math.max(x,500),n=Math.max(u,500);if(x<t||u<n){const l=document.createElement("canvas");l.width=t,l.height=n;const f=l.getContext("2d");f.fillStyle="#ffffff",f.fillRect(0,0,t,n);const k=Math.floor((t-x)/2),H=Math.floor((n-u)/2);f.drawImage(o,k,H),o=l,b=f}}const M=document.createElement("canvas");M.width=o.width,M.height=o.height;const v=M.getContext("2d");v.fillStyle="#ffffff",v.fillRect(0,0,M.width,M.height),v.drawImage(o,0,0);const j=await new Promise(t=>M.toBlob(t,"image/jpeg",.95)),N=`${d}-${m+p}.jpg`;e.file(N,j),i++}catch(h){console.error("Błąd przetwarzania klienta:",h),s&&s(`Błąd: ${I.name}`)}}return s&&s("Pakowanie ZIP..."),await e.generateAsync({type:"blob"})};export{_ as processFilesClientSide};
//# sourceMappingURL=client-processor-D-td7EAr.js.map

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./assets/client-processor-DndueCvx.js","./assets/vendor-529iNPX7.js"])))=>i.map(i=>d[i]);
import"./assets/modulepreload-polyfill-B5Qt9EMX.js";const O="modulepreload",F=function(e,n){return new URL(e,n).href},A={},j=function(n,t,o){let c=Promise.resolve();if(t&&t.length>0){const a=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),g=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));c=Promise.allSettled(t.map(l=>{if(l=F(l,o),l in A)return;A[l]=!0;const m=l.endsWith(".css"),P=m?'[rel="stylesheet"]':"";if(!!o)for(let v=a.length-1;v>=0;v--){const L=a[v];if(L.href===l&&(!m||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${P}`))return;const f=document.createElement("link");if(f.rel=m?"stylesheet":O,m||(f.as="script"),f.crossOrigin="",f.href=l,g&&f.setAttribute("nonce",g),document.head.appendChild(f),m)return new Promise((v,L)=>{f.addEventListener("load",v),f.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return c.then(a=>{for(const r of a||[])r.status==="rejected"&&i(r.reason);return n().catch(i)})};let d=[];const x=(e,n=18)=>{if(e.length<=n)return e;const t=e.split("."),o=t.length>1?`.${t.pop()}`:"",c=t.join("."),i=8,a=6;return c.length<=i?`${c.substring(0,i)}...${o}`:`${c.substring(0,i)}...${c.substring(c.length-a)}${o}`};let p,E,z,B,C,b,R,T,u,U,w,y,$,I;document.addEventListener("DOMContentLoaded",()=>{console.log("DOM Loaded - initializing Tools"),p=document.getElementById("file-dropzone"),E=document.getElementById("file-input"),z=document.getElementById("file-list"),B=document.getElementById("clear-list"),C=document.getElementById("execute-btn"),b=document.getElementById("console-log"),R=document.getElementById("theme-toggle"),T=document.getElementById("processing-mode"),u=document.getElementById("base-name"),U=document.getElementById("start-number"),w=document.getElementById("opt-crop"),y=document.getElementById("opt-trim-only"),$=document.getElementById("opt-add-margin"),I=document.getElementById("opt-resize"),window.electronAPI&&(document.body.classList.add("is-electron"),s("Tryb Desktop (Electron) aktywny."),y&&(y.checked=!0),w&&(w.checked=!1));const e=localStorage.getItem("theme")||"dark";if(document.documentElement.setAttribute("data-theme",e),R&&R.addEventListener("click",()=>{const t=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),s(`Zmiana motywu na: ${t}`)}),p&&E?(p.addEventListener("click",()=>{console.log("Dropzone clicked"),E.click()}),E.addEventListener("change",n=>{S(n.target.files),E.value=""}),p.addEventListener("dragover",n=>{n.preventDefault(),p.style.borderColor="var(--accent-color)"}),p.addEventListener("dragleave",n=>{n.preventDefault(),p.style.borderColor="var(--border-color)"}),p.addEventListener("drop",n=>{n.preventDefault(),p.style.borderColor="var(--border-color)",S(n.dataTransfer.files)})):console.error("Brak elementu dropzone lub fileInput!"),B&&B.addEventListener("click",()=>{d=[],k(),s("Lista wyczyszczona.")}),u){const n=async()=>{try{const t=await navigator.clipboard.readText();if(t){const o=D(t);o&&u.value!==o&&(u.value=o,u.classList.add("flash-input"),setTimeout(()=>u.classList.remove("flash-input"),500),s(`Wklejono ze schowka: ${o}`))}}catch{}};u.addEventListener("mouseenter",n),u.addEventListener("click",n),u.addEventListener("focus",n),window.addEventListener("focus",()=>{u.matches(":hover")&&n()}),u.addEventListener("input",()=>{const t=u.value,o=D(t);t!==o&&(u.value=o)})}C&&C.addEventListener("click",async()=>{W()})});function s(e){if(!b)return;const n=document.createElement("p");n.textContent=`> ${e}`,b.appendChild(n),b.scrollTop=b.scrollHeight}const D=e=>{const n={ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ó:"o",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ó:"O",Ś:"S",Ź:"Z",Ż:"Z"};let t=e.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g,o=>n[o]);return t=t.replace(/[^a-zA-Z0-9]/g,"-"),t=t.replace(/-+/g,"-"),t=t.replace(/^-+|-+$/g,""),t};function k(){z&&(z.innerHTML="",d.forEach((e,n)=>{const t=document.createElement("li");t.className="file-item";const o=document.createElement("input");o.type="checkbox",o.className="file-select",o.checked=e.selected,o.onchange=r=>{e.selected=r.target.checked};const c=document.createElement("span");c.className="file-info";const i=x(e.file.name);c.textContent=`[${n+1}] ${i} (${(e.file.size/1024).toFixed(1)} KB) (${e.width}x${e.height} px)`,c.title=e.file.name,c.addEventListener("mouseenter",r=>M(r,e.file)),c.addEventListener("mouseleave",_),c.addEventListener("mousemove",N);const a=document.createElement("div");a.className="file-controls",a.innerHTML=`
        <button class="btn btn-sm" onclick="window.moveUp(${n})">▲</button>
        <button class="btn btn-sm" onclick="window.moveDown(${n})">▼</button>
        <button class="btn btn-sm" onclick="window.removeFile(${n})" style="color:var(--error-color); border-color:var(--error-color);">X</button>
    `,t.appendChild(o),t.appendChild(c),t.appendChild(a),z.appendChild(t)}))}const h=document.getElementById("preview-tooltip");function M(e,n){if(!h)return;const t=URL.createObjectURL(n);h.innerHTML=`<img src="${t}" alt="Preview">`,h.style.display="block",N(e)}function N(e){if(!h)return;const n=e.clientX+15,t=e.clientY+15;h.style.left=n+"px",h.style.top=t+"px"}function _(){h&&(h.style.display="none",h.innerHTML="")}const K=e=>new Promise((n,t)=>{const o=new Image;o.onload=()=>{URL.revokeObjectURL(o.src),n({width:o.width,height:o.height})},o.onerror=t,o.src=URL.createObjectURL(e)});async function S(e){const n=[];for(const t of Array.from(e))if(t.type.startsWith("image/"))try{const{width:o,height:c}=await K(t);n.push({file:t,id:Date.now()+Math.random(),selected:!0,width:o,height:c}),s(`Dodano: ${t.name} (${o}x${c} px)`)}catch(o){s(`BŁĄD podczas wczytywania wymiarów pliku ${t.name}: ${o.message}`)}else s(`BŁĄD: ${t.name} nie jest obrazem.`);d.push(...n),k()}window.moveUp=e=>{e>0&&([d[e-1],d[e]]=[d[e],d[e-1]],k())};window.moveDown=e=>{e<d.length-1&&([d[e+1],d[e]]=[d[e],d[e+1]],k())};window.removeFile=e=>{const n=d[e];if(n.selected){const t=d.length;d=d.filter(c=>!c.selected);const o=t-d.length;s(`Usunięto zaznaczone pliki: ${o}`)}else s(`Usunięto: ${n.file.name}`),d.splice(e,1);k()};async function W(){const e=d.filter(i=>i.selected);if(e.length===0){s("BŁĄD: Brak zaznaczonych plików do przetworzenia.");return}const n=u.value.trim()||"image",t=parseInt(U.value)||1,o=T.value;if(s(`Rozpoczynanie procedury dla ${e.length} plików (${o==="local"?"LOKALNIE":"SERWER"})...`),window.electronAPI){s("Wykryto środowisko Desktop (Electron). Używam natywnego przetwarzania...");let i=e.map(r=>r.file.path?r.file.path:(s(`OSTRZEŻENIE: Brak ścieżki dla pliku: ${r.file.name}. Sprawdź uprawnienia lub metodę dodawania.`),null)).filter(r=>r!==null);if(i.length===0){s("BŁĄD: Nie udało się pobrać ścieżek plików. Operacja przerwana.");return}s(`Wysyłanie ${i.length} plików do procesu głównego...`);const a={baseName:n,startNumber:t,optCrop:w.checked,optTrimOnly:y.checked,optAddMargin:$.checked,optResize:I.checked};window.electronLogListenerAdded||(window.electronAPI.onLog(r=>s(r)),window.electronLogListenerAdded=!0);try{const r=await window.electronAPI.processImages(i,a);r.success?s(`SUKCES: Zapisano w katalogu: ${r.path}`):s(`BŁĄD: ${r.message}`)}catch(r){s(`BŁĄD KRYTYCZNY: ${r.message}`)}return}if(o==="local"){const i={baseName:n,startNumber:t,optCrop:w.checked,optTrimOnly:y.checked,optAddMargin:$.checked,optResize:I.checked};try{const{processFilesClientSide:a}=await j(async()=>{const{processFilesClientSide:m}=await import("./assets/client-processor-DndueCvx.js");return{processFilesClientSide:m}},__vite__mapDeps([0,1]),import.meta.url),r=await a(e,i,m=>s(m)),g=window.URL.createObjectURL(r),l=document.createElement("a");l.href=g,l.download="processed.zip",document.body.appendChild(l),l.click(),l.remove(),s("SUKCES: Gotowe (Lokalnie).")}catch(a){s(`BŁĄD LOKALNY: ${a.message}`)}return}const c=new FormData;e.forEach(i=>{c.append("images",i.file)}),c.append("newName",n),c.append("startNumber",t),c.append("optCrop",w.checked),c.append("optTrimOnly",y.checked),c.append("optAddMargin",$.checked),c.append("optResize",I.checked);try{const a=await fetch("http://localhost:3000/upload-tools",{method:"POST",body:c});if(a.ok){s("SUKCES: Pliki przetworzone.");const r=await a.blob(),g=window.URL.createObjectURL(r),l=document.createElement("a");l.href=g,l.download="processed.zip",document.body.appendChild(l),l.click(),l.remove(),s("Rozpoczęto pobieranie archiwum.")}else{const r=await a.text();s(`BŁĄD SERWERA: ${r}`)}}catch(i){s(`BŁĄD SIECI: ${i.message}`)}}
//# sourceMappingURL=tools.js.map

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./assets/client-processor-DndueCvx.js","./assets/vendor-529iNPX7.js"])))=>i.map(i=>d[i]);
import"./assets/modulepreload-polyfill-B5Qt9EMX.js";const N="modulepreload",x=function(t,n){return new URL(t,n).href},A={},F=function(n,e,o){let c=Promise.resolve();if(e&&e.length>0){const a=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),g=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));c=Promise.allSettled(e.map(i=>{if(i=x(i,o),i in A)return;A[i]=!0;const u=i.endsWith(".css"),O=u?'[rel="stylesheet"]':"";if(!!o)for(let v=a.length-1;v>=0;v--){const k=a[v];if(k.href===i&&(!u||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${O}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":N,u||(f.as="script"),f.crossOrigin="",f.href=i,g&&f.setAttribute("nonce",g),document.head.appendChild(f),u)return new Promise((v,k)=>{f.addEventListener("load",v),f.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${i}`)))})}))}function d(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return c.then(a=>{for(const r of a||[])r.status==="rejected"&&d(r.reason);return n().catch(d)})};let l=[],p,E,z,C,$,L,R,S,m,U,w,y,I,B;document.addEventListener("DOMContentLoaded",()=>{console.log("DOM Loaded - initializing Tools"),p=document.getElementById("file-dropzone"),E=document.getElementById("file-input"),z=document.getElementById("file-list"),C=document.getElementById("clear-list"),$=document.getElementById("execute-btn"),L=document.getElementById("console-log"),R=document.getElementById("theme-toggle"),S=document.getElementById("processing-mode"),m=document.getElementById("base-name"),U=document.getElementById("start-number"),w=document.getElementById("opt-crop"),y=document.getElementById("opt-trim-only"),I=document.getElementById("opt-add-margin"),B=document.getElementById("opt-resize"),window.electronAPI&&(document.body.classList.add("is-electron"),s("Tryb Desktop (Electron) aktywny."),y&&(y.checked=!0),w&&(w.checked=!1));const t=localStorage.getItem("theme")||"dark";if(document.documentElement.setAttribute("data-theme",t),R&&R.addEventListener("click",()=>{const e=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),s(`Zmiana motywu na: ${e}`)}),p&&E?(p.addEventListener("click",()=>{console.log("Dropzone clicked"),E.click()}),E.addEventListener("change",n=>{T(n.target.files),E.value=""}),p.addEventListener("dragover",n=>{n.preventDefault(),p.style.borderColor="var(--accent-color)"}),p.addEventListener("dragleave",n=>{n.preventDefault(),p.style.borderColor="var(--border-color)"}),p.addEventListener("drop",n=>{n.preventDefault(),p.style.borderColor="var(--border-color)",T(n.dataTransfer.files)})):console.error("Brak elementu dropzone lub fileInput!"),C&&C.addEventListener("click",()=>{l=[],b(),s("Lista wyczyszczona.")}),m){const n=async()=>{try{const e=await navigator.clipboard.readText();if(e){const o=D(e);o&&m.value!==o&&(m.value=o,m.classList.add("flash-input"),setTimeout(()=>m.classList.remove("flash-input"),500),s(`Wklejono ze schowka: ${o}`))}}catch{}};m.addEventListener("mouseenter",n),m.addEventListener("click",n),m.addEventListener("focus",n),window.addEventListener("focus",()=>{m.matches(":hover")&&n()}),m.addEventListener("input",()=>{const e=m.value,o=D(e);e!==o&&(m.value=o)})}$&&$.addEventListener("click",async()=>{K()})});function s(t){if(!L)return;const n=document.createElement("p");n.textContent=`> ${t}`,L.appendChild(n),L.scrollTop=L.scrollHeight}const D=t=>{const n={ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ó:"o",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ó:"O",Ś:"S",Ź:"Z",Ż:"Z"};let e=t.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g,o=>n[o]);return e=e.replace(/[^a-zA-Z0-9]/g,"-"),e=e.replace(/-+/g,"-"),e=e.replace(/^-+|-+$/g,""),e};function b(){z&&(z.innerHTML="",l.forEach((t,n)=>{const e=document.createElement("li");e.className="file-item";const o=document.createElement("input");o.type="checkbox",o.className="file-select",o.checked=t.selected,o.onchange=a=>{t.selected=a.target.checked};const c=document.createElement("span");c.className="file-info",c.textContent=`[${n+1}] ${t.file.name} (${(t.file.size/1024).toFixed(1)} KB) (${t.width}x${t.height} px)`,c.addEventListener("mouseenter",a=>M(a,t.file)),c.addEventListener("mouseleave",_),c.addEventListener("mousemove",P);const d=document.createElement("div");d.className="file-controls",d.innerHTML=`
        <button class="btn btn-sm" onclick="window.moveUp(${n})">▲</button>
        <button class="btn btn-sm" onclick="window.moveDown(${n})">▼</button>
        <button class="btn btn-sm" onclick="window.removeFile(${n})" style="color:var(--error-color); border-color:var(--error-color);">X</button>
    `,e.appendChild(o),e.appendChild(c),e.appendChild(d),z.appendChild(e)}))}const h=document.getElementById("preview-tooltip");function M(t,n){if(!h)return;const e=URL.createObjectURL(n);h.innerHTML=`<img src="${e}" alt="Preview">`,h.style.display="block",P(t)}function P(t){if(!h)return;const n=t.clientX+15,e=t.clientY+15;h.style.left=n+"px",h.style.top=e+"px"}function _(){h&&(h.style.display="none",h.innerHTML="")}const j=t=>new Promise((n,e)=>{const o=new Image;o.onload=()=>{URL.revokeObjectURL(o.src),n({width:o.width,height:o.height})},o.onerror=e,o.src=URL.createObjectURL(t)});async function T(t){const n=[];for(const e of Array.from(t))if(e.type.startsWith("image/"))try{const{width:o,height:c}=await j(e);n.push({file:e,id:Date.now()+Math.random(),selected:!0,width:o,height:c}),s(`Dodano: ${e.name} (${o}x${c} px)`)}catch(o){s(`BŁĄD podczas wczytywania wymiarów pliku ${e.name}: ${o.message}`)}else s(`BŁĄD: ${e.name} nie jest obrazem.`);l.push(...n),b()}window.moveUp=t=>{t>0&&([l[t-1],l[t]]=[l[t],l[t-1]],b())};window.moveDown=t=>{t<l.length-1&&([l[t+1],l[t]]=[l[t],l[t+1]],b())};window.removeFile=t=>{const n=l[t];if(n.selected){const e=l.length;l=l.filter(c=>!c.selected);const o=e-l.length;s(`Usunięto zaznaczone pliki: ${o}`)}else s(`Usunięto: ${n.file.name}`),l.splice(t,1);b()};async function K(){const t=l.filter(d=>d.selected);if(t.length===0){s("BŁĄD: Brak zaznaczonych plików do przetworzenia.");return}const n=m.value.trim()||"image",e=parseInt(U.value)||1,o=S.value;if(s(`Rozpoczynanie procedury dla ${t.length} plików (${o==="local"?"LOKALNIE":"SERWER"})...`),window.electronAPI){s("Wykryto środowisko Desktop (Electron). Używam natywnego przetwarzania...");const d=t.map(r=>r.file.path),a={baseName:n,startNumber:e,optCrop:w.checked,optTrimOnly:y.checked,optAddMargin:I.checked,optResize:B.checked};window.electronLogListenerAdded||(window.electronAPI.onLog(r=>s(r)),window.electronLogListenerAdded=!0);try{const r=await window.electronAPI.processImages(d,a);r.success?s(`SUKCES: Zapisano w katalogu: ${r.path}`):s(`BŁĄD: ${r.message}`)}catch(r){s(`BŁĄD KRYTYCZNY: ${r.message}`)}return}if(o==="local"){const d={baseName:n,startNumber:e,optCrop:w.checked,optTrimOnly:y.checked,optAddMargin:I.checked,optResize:B.checked};try{const{processFilesClientSide:a}=await F(async()=>{const{processFilesClientSide:u}=await import("./assets/client-processor-DndueCvx.js");return{processFilesClientSide:u}},__vite__mapDeps([0,1]),import.meta.url),r=await a(t,d,u=>s(u)),g=window.URL.createObjectURL(r),i=document.createElement("a");i.href=g,i.download="processed.zip",document.body.appendChild(i),i.click(),i.remove(),s("SUKCES: Gotowe (Lokalnie).")}catch(a){s(`BŁĄD LOKALNY: ${a.message}`)}return}const c=new FormData;t.forEach(d=>{c.append("images",d.file)}),c.append("newName",n),c.append("startNumber",e),c.append("optCrop",w.checked),c.append("optTrimOnly",y.checked),c.append("optAddMargin",I.checked),c.append("optResize",B.checked);try{const a=await fetch("http://localhost:3000/upload-tools",{method:"POST",body:c});if(a.ok){s("SUKCES: Pliki przetworzone.");const r=await a.blob(),g=window.URL.createObjectURL(r),i=document.createElement("a");i.href=g,i.download="processed.zip",document.body.appendChild(i),i.click(),i.remove(),s("Rozpoczęto pobieranie archiwum.")}else{const r=await a.text();s(`BŁĄD SERWERA: ${r}`)}}catch(d){s(`BŁĄD SIECI: ${d.message}`)}}
//# sourceMappingURL=tools.js.map

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./assets/client-processor-DndueCvx.js","./assets/vendor-529iNPX7.js"])))=>i.map(i=>d[i]);
import"./assets/modulepreload-polyfill-B5Qt9EMX.js";const O="modulepreload",F=function(e,n){return new URL(e,n).href},A={},x=function(n,t,o){let c=Promise.resolve();if(t&&t.length>0){const s=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),g=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));c=Promise.allSettled(t.map(i=>{if(i=F(i,o),i in A)return;A[i]=!0;const u=i.endsWith(".css"),N=u?'[rel="stylesheet"]':"";if(!!o)for(let v=s.length-1;v>=0;v--){const k=s[v];if(k.href===i&&(!u||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${N}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":O,u||(f.as="script"),f.crossOrigin="",f.href=i,g&&f.setAttribute("nonce",g),document.head.appendChild(f),u)return new Promise((v,k)=>{f.addEventListener("load",v),f.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${i}`)))})}))}function l(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return c.then(s=>{for(const r of s||[])r.status==="rejected"&&l(r.reason);return n().catch(l)})};let d=[];const j=(e,n=18)=>{if(e.length<=n)return e;const t=e.split("."),o=t.length>1?`.${t.pop()}`:"",c=t.join("."),l=8,s=6;return c.length<=l?`${c.substring(0,l)}...${o}`:`${c.substring(0,l)}...${c.substring(c.length-s)}${o}`};let p,E,z,C,B,b,R,S,m,U,w,y,$,I;document.addEventListener("DOMContentLoaded",()=>{console.log("DOM Loaded - initializing Tools"),p=document.getElementById("file-dropzone"),E=document.getElementById("file-input"),z=document.getElementById("file-list"),C=document.getElementById("clear-list"),B=document.getElementById("execute-btn"),b=document.getElementById("console-log"),R=document.getElementById("theme-toggle"),S=document.getElementById("processing-mode"),m=document.getElementById("base-name"),U=document.getElementById("start-number"),w=document.getElementById("opt-crop"),y=document.getElementById("opt-trim-only"),$=document.getElementById("opt-add-margin"),I=document.getElementById("opt-resize"),window.electronAPI&&(document.body.classList.add("is-electron"),a("Tryb Desktop (Electron) aktywny."),y&&(y.checked=!0),w&&(w.checked=!1));const e=localStorage.getItem("theme")||"dark";if(document.documentElement.setAttribute("data-theme",e),R&&R.addEventListener("click",()=>{const t=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),a(`Zmiana motywu na: ${t}`)}),p&&E?(p.addEventListener("click",()=>{console.log("Dropzone clicked"),E.click()}),E.addEventListener("change",n=>{T(n.target.files),E.value=""}),p.addEventListener("dragover",n=>{n.preventDefault(),p.style.borderColor="var(--accent-color)"}),p.addEventListener("dragleave",n=>{n.preventDefault(),p.style.borderColor="var(--border-color)"}),p.addEventListener("drop",n=>{n.preventDefault(),p.style.borderColor="var(--border-color)",T(n.dataTransfer.files)})):console.error("Brak elementu dropzone lub fileInput!"),C&&C.addEventListener("click",()=>{d=[],L(),a("Lista wyczyszczona.")}),m){const n=async()=>{try{const t=await navigator.clipboard.readText();if(t){const o=D(t);o&&m.value!==o&&(m.value=o,m.classList.add("flash-input"),setTimeout(()=>m.classList.remove("flash-input"),500),a(`Wklejono ze schowka: ${o}`))}}catch{}};m.addEventListener("mouseenter",n),m.addEventListener("click",n),m.addEventListener("focus",n),window.addEventListener("focus",()=>{m.matches(":hover")&&n()}),m.addEventListener("input",()=>{const t=m.value,o=D(t);t!==o&&(m.value=o)})}B&&B.addEventListener("click",async()=>{W()})});function a(e){if(!b)return;const n=document.createElement("p");n.textContent=`> ${e}`,b.appendChild(n),b.scrollTop=b.scrollHeight}const D=e=>{const n={ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ó:"o",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ó:"O",Ś:"S",Ź:"Z",Ż:"Z"};let t=e.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g,o=>n[o]);return t=t.replace(/[^a-zA-Z0-9]/g,"-"),t=t.replace(/-+/g,"-"),t=t.replace(/^-+|-+$/g,""),t};function L(){z&&(z.innerHTML="",d.forEach((e,n)=>{const t=document.createElement("li");t.className="file-item";const o=document.createElement("input");o.type="checkbox",o.className="file-select",o.checked=e.selected,o.onchange=r=>{e.selected=r.target.checked};const c=document.createElement("span");c.className="file-info";const l=j(e.file.name);c.textContent=`[${n+1}] ${l} (${(e.file.size/1024).toFixed(1)} KB) (${e.width}x${e.height} px)`,c.title=e.file.name,c.addEventListener("mouseenter",r=>M(r,e.file)),c.addEventListener("mouseleave",_),c.addEventListener("mousemove",P);const s=document.createElement("div");s.className="file-controls",s.innerHTML=`
        <button class="btn btn-sm" onclick="window.moveUp(${n})">▲</button>
        <button class="btn btn-sm" onclick="window.moveDown(${n})">▼</button>
        <button class="btn btn-sm" onclick="window.removeFile(${n})" style="color:var(--error-color); border-color:var(--error-color);">X</button>
    `,t.appendChild(o),t.appendChild(c),t.appendChild(s),z.appendChild(t)}))}const h=document.getElementById("preview-tooltip");function M(e,n){if(!h)return;const t=URL.createObjectURL(n);h.innerHTML=`<img src="${t}" alt="Preview">`,h.style.display="block",P(e)}function P(e){if(!h)return;const n=e.clientX+15,t=e.clientY+15;h.style.left=n+"px",h.style.top=t+"px"}function _(){h&&(h.style.display="none",h.innerHTML="")}const K=e=>new Promise((n,t)=>{const o=new Image;o.onload=()=>{URL.revokeObjectURL(o.src),n({width:o.width,height:o.height})},o.onerror=t,o.src=URL.createObjectURL(e)});async function T(e){const n=[];for(const t of Array.from(e))if(t.type.startsWith("image/"))try{const{width:o,height:c}=await K(t);n.push({file:t,id:Date.now()+Math.random(),selected:!0,width:o,height:c}),a(`Dodano: ${t.name} (${o}x${c} px)`)}catch(o){a(`BŁĄD podczas wczytywania wymiarów pliku ${t.name}: ${o.message}`)}else a(`BŁĄD: ${t.name} nie jest obrazem.`);d.push(...n),L()}window.moveUp=e=>{e>0&&([d[e-1],d[e]]=[d[e],d[e-1]],L())};window.moveDown=e=>{e<d.length-1&&([d[e+1],d[e]]=[d[e],d[e+1]],L())};window.removeFile=e=>{const n=d[e];if(n.selected){const t=d.length;d=d.filter(c=>!c.selected);const o=t-d.length;a(`Usunięto zaznaczone pliki: ${o}`)}else a(`Usunięto: ${n.file.name}`),d.splice(e,1);L()};async function W(){const e=d.filter(l=>l.selected);if(e.length===0){a("BŁĄD: Brak zaznaczonych plików do przetworzenia.");return}const n=m.value.trim()||"image",t=parseInt(U.value)||1,o=S.value;if(a(`Rozpoczynanie procedury dla ${e.length} plików (${o==="local"?"LOKALNIE":"SERWER"})...`),window.electronAPI){a("Wykryto środowisko Desktop (Electron). Używam natywnego przetwarzania...");const l=e.map(r=>r.file.path),s={baseName:n,startNumber:t,optCrop:w.checked,optTrimOnly:y.checked,optAddMargin:$.checked,optResize:I.checked};window.electronLogListenerAdded||(window.electronAPI.onLog(r=>a(r)),window.electronLogListenerAdded=!0);try{const r=await window.electronAPI.processImages(l,s);r.success?a(`SUKCES: Zapisano w katalogu: ${r.path}`):a(`BŁĄD: ${r.message}`)}catch(r){a(`BŁĄD KRYTYCZNY: ${r.message}`)}return}if(o==="local"){const l={baseName:n,startNumber:t,optCrop:w.checked,optTrimOnly:y.checked,optAddMargin:$.checked,optResize:I.checked};try{const{processFilesClientSide:s}=await x(async()=>{const{processFilesClientSide:u}=await import("./assets/client-processor-DndueCvx.js");return{processFilesClientSide:u}},__vite__mapDeps([0,1]),import.meta.url),r=await s(e,l,u=>a(u)),g=window.URL.createObjectURL(r),i=document.createElement("a");i.href=g,i.download="processed.zip",document.body.appendChild(i),i.click(),i.remove(),a("SUKCES: Gotowe (Lokalnie).")}catch(s){a(`BŁĄD LOKALNY: ${s.message}`)}return}const c=new FormData;e.forEach(l=>{c.append("images",l.file)}),c.append("newName",n),c.append("startNumber",t),c.append("optCrop",w.checked),c.append("optTrimOnly",y.checked),c.append("optAddMargin",$.checked),c.append("optResize",I.checked);try{const s=await fetch("http://localhost:3000/upload-tools",{method:"POST",body:c});if(s.ok){a("SUKCES: Pliki przetworzone.");const r=await s.blob(),g=window.URL.createObjectURL(r),i=document.createElement("a");i.href=g,i.download="processed.zip",document.body.appendChild(i),i.click(),i.remove(),a("Rozpoczęto pobieranie archiwum.")}else{const r=await s.text();a(`BŁĄD SERWERA: ${r}`)}}catch(l){a(`BŁĄD SIECI: ${l.message}`)}}
//# sourceMappingURL=tools.js.map

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./assets/client-processor-Dwghfj9O.js","./assets/vendor-529iNPX7.js"])))=>i.map(i=>d[i]);
import"./assets/modulepreload-polyfill-B5Qt9EMX.js";const M="modulepreload",Z=function(e,n){return new URL(e,n).href},A={},T=function(n,t,o){let a=Promise.resolve();if(t&&t.length>0){const d=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),p=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));a=Promise.allSettled(t.map(i=>{if(i=Z(i,o),i in A)return;A[i]=!0;const u=i.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(!!o)for(let g=d.length-1;g>=0;g--){const L=d[g];if(L.href===i&&(!u||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${c}`))return;const l=document.createElement("link");if(l.rel=u?"stylesheet":M,u||(l.as="script"),l.crossOrigin="",l.href=i,p&&l.setAttribute("nonce",p),document.head.appendChild(l),u)return new Promise((g,L)=>{l.addEventListener("load",g),l.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${i}`)))})}))}function w(d){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=d,window.dispatchEvent(s),!s.defaultPrevented)throw d}return a.then(d=>{for(const s of d||[])s.status==="rejected"&&w(s.reason);return n().catch(w)})};let m=[];const W=(e,n=18)=>{if(e.length<=n)return e;const t=e.split("."),o=t.length>1?`.${t.pop()}`:"",a=t.join("."),w=8,d=6;return a.length<=w?`${a.substring(0,w)}...${o}`:`${a.substring(0,w)}...${a.substring(a.length-d)}${o}`};let y,E,z,B,C,b,P,F,h,O,I,$,U,N,_,j;document.addEventListener("DOMContentLoaded",()=>{console.log("DOM Loaded - initializing Tools"),y=document.getElementById("file-dropzone"),E=document.getElementById("file-input"),z=document.getElementById("file-list"),B=document.getElementById("clear-list"),C=document.getElementById("execute-btn"),b=document.getElementById("console-log"),P=document.getElementById("theme-toggle"),F=document.getElementById("processing-mode"),h=document.getElementById("base-name"),O=document.getElementById("start-number"),N=document.getElementById("mode-smart"),_=document.getElementById("mode-simple"),j=document.getElementById("mode-none"),I=document.getElementById("opt-add-margin"),$=document.getElementById("opt-resize"),U=document.getElementById("opt-overwrite"),window.electronAPI&&(document.body.classList.add("is-electron"),r("Tryb Desktop (Electron) aktywny."));const e=localStorage.getItem("theme")||"dark";if(document.documentElement.setAttribute("data-theme",e),P&&P.addEventListener("click",()=>{const t=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),r(`Zmiana motywu na: ${t}`)}),y&&E?(y.addEventListener("click",()=>{console.log("Dropzone clicked"),E.click()}),E.addEventListener("change",n=>{S(n.target.files),E.value=""}),y.addEventListener("dragover",n=>{n.preventDefault(),y.style.borderColor="var(--accent-color)"}),y.addEventListener("dragleave",n=>{n.preventDefault(),y.style.borderColor="var(--border-color)"}),y.addEventListener("drop",n=>{n.preventDefault(),y.style.borderColor="var(--border-color)",S(n.dataTransfer.files)})):console.error("Brak elementu dropzone lub fileInput!"),B&&B.addEventListener("click",()=>{m=[],k(),r("Lista wyczyszczona.")}),h){const n=async()=>{try{const t=await navigator.clipboard.readText();if(t){const o=R(t);o&&h.value!==o&&(h.value=o,h.classList.add("flash-input"),setTimeout(()=>h.classList.remove("flash-input"),500),r(`Wklejono ze schowka: ${o}`))}}catch{}};h.addEventListener("mouseenter",n),h.addEventListener("focus",n),window.addEventListener("focus",()=>{h.matches(":hover")&&n()}),h.addEventListener("input",()=>{const t=h.value,o=R(t);t!==o&&(h.value=o)})}C&&C.addEventListener("click",async()=>{V()})});function r(e){if(!b)return;const n=document.createElement("p");n.textContent=`> ${e}`,b.appendChild(n),b.scrollTop=b.scrollHeight}const R=e=>{const n={ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ó:"o",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ó:"O",Ś:"S",Ź:"Z",Ż:"Z"};let t=e.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g,o=>n[o]);return t=t.replace(/[^a-zA-Z0-9]/g,"-"),t=t.replace(/-+/g,"-"),t=t.replace(/^-+|-+$/g,""),t};function k(){z&&(z.innerHTML="",m.forEach((e,n)=>{const t=document.createElement("li");t.className="file-item";const o=document.createElement("input");o.type="checkbox",o.className="file-select",o.checked=e.selected,o.onchange=s=>{e.selected=s.target.checked};const a=document.createElement("span");a.className="file-info";const w=W(e.file.name);a.textContent=`[${n+1}] ${w} (${(e.file.size/1024).toFixed(1)} KB) (${e.width}x${e.height} px)`,a.title=e.file.name,a.addEventListener("mouseenter",s=>K(s,e.file)),a.addEventListener("mouseleave",H),a.addEventListener("mousemove",x);const d=document.createElement("div");d.className="file-controls",d.innerHTML=`
        <button class="btn btn-sm" onclick="window.moveUp(${n})">▲</button>
        <button class="btn btn-sm" onclick="window.moveDown(${n})">▼</button>
        <button class="btn btn-sm" onclick="window.removeFile(${n})" style="color:var(--error-color); border-color:var(--error-color);">X</button>
    `,t.appendChild(o),t.appendChild(a),t.appendChild(d),z.appendChild(t)}))}const v=document.getElementById("preview-tooltip");function K(e,n){if(!v)return;const t=URL.createObjectURL(n);v.innerHTML=`<img src="${t}" alt="Preview">`,v.style.display="block",x(e)}function x(e){if(!v)return;const n=e.clientX+15,t=e.clientY+15;v.style.left=n+"px",v.style.top=t+"px"}function H(){v&&(v.style.display="none",v.innerHTML="")}const Y=e=>new Promise((n,t)=>{const o=new Image;o.onload=()=>{URL.revokeObjectURL(o.src),n({width:o.width,height:o.height})},o.onerror=t,o.src=URL.createObjectURL(e)});async function S(e){const n=[];for(const t of Array.from(e))if(t.type.startsWith("image/"))try{const{width:o,height:a}=await Y(t);n.push({file:t,id:Date.now()+Math.random(),selected:!0,width:o,height:a}),r(`Dodano: ${t.name} (${o}x${a} px)`)}catch(o){r(`BŁĄD podczas wczytywania wymiarów pliku ${t.name}: ${o.message}`)}else r(`BŁĄD: ${t.name} nie jest obrazem.`);m.push(...n),k()}window.moveUp=e=>{e>0&&([m[e-1],m[e]]=[m[e],m[e-1]],k())};window.moveDown=e=>{e<m.length-1&&([m[e+1],m[e]]=[m[e],m[e+1]],k())};window.removeFile=e=>{const n=m[e];if(n.selected){const t=m.length;m=m.filter(a=>!a.selected);const o=t-m.length;r(`Usunięto zaznaczone pliki: ${o}`)}else r(`Usunięto: ${n.file.name}`),m.splice(e,1);k()};async function D(e,n){r("Uruchamianie trybu awaryjnego (Canvas API)...");try{const{processFilesClientSide:t}=await T(async()=>{const{processFilesClientSide:o}=await import("./assets/client-processor-Dwghfj9O.js");return{processFilesClientSide:o}},__vite__mapDeps([0,1]),import.meta.url);await t(e,n,o=>r(o),async(o,a,w)=>{const d=await o.arrayBuffer(),s=window.electronAPI.getPathForFile?window.electronAPI.getPathForFile(w):w.path,p=await window.electronAPI.saveFile(s,a,d,n.optOverwrite);p.success?r(`Zapisano (Canvas): ${p.path}`):r(`Błąd zapisu (Canvas): ${p.message}`)}),r("Zakończono przetwarzanie w trybie awaryjnym.")}catch(t){r(`BŁĄD KRYTYCZNY (Fallback): ${t.message}`)}}async function V(){const e=m.filter(i=>i.selected);if(e.length===0){r("BŁĄD: Brak zaznaczonych plików do przetworzenia.");return}const n=h.value.trim()||"image",t=parseInt(O.value)||1,o=F.value,a=N.checked,w=_.checked;j.checked;const d=a,s=w;if(r(`Rozpoczynanie procedury dla ${e.length} plików...`),window.electronAPI){r("Wykryto środowisko Desktop (Electron). Używam natywnego przetwarzania...");let i=e.map(c=>{let f=null;return window.electronAPI.getPathForFile&&(f=window.electronAPI.getPathForFile(c.file)),f||(f=c.file.path),f||(r(`OSTRZEŻENIE: Brak ścieżki dla pliku: ${c.file.name}. Sprawdź uprawnienia lub metodę dodawania.`),null)}).filter(c=>c!==null);if(i.length===0){r("BŁĄD: Nie udało się pobrać ścieżek plików. Operacja przerwana.");return}r(`Wysyłanie ${i.length} plików do procesu głównego...`);const u={baseName:n,startNumber:t,optCrop:d,optTrimOnly:s,optAddMargin:I.checked,optResize:$.checked,optOverwrite:U.checked};window.electronLogListenerAdded||(window.electronAPI.onLog(c=>r(c)),window.electronLogListenerAdded=!0);try{const c=await window.electronAPI.processImages(i,u);c.success?r(`SUKCES: Zapisano w katalogu: ${c.path}`):(r(`BŁĄD WORKERA: ${c.message}`),await D(e,u))}catch(c){r(`BŁĄD API: ${c.message}`),await D(e,u)}return}if(o==="local"){r("Tryb WEB (Lokalny) - start przetwarzania...");const i={baseName:n,startNumber:t,optCrop:d,optTrimOnly:s,optAddMargin:I.checked,optResize:$.checked};try{const{processFilesClientSide:u}=await T(async()=>{const{processFilesClientSide:g}=await import("./assets/client-processor-Dwghfj9O.js");return{processFilesClientSide:g}},__vite__mapDeps([0,1]),import.meta.url),c=await u(e,i,g=>r(g)),f=window.URL.createObjectURL(c),l=document.createElement("a");l.href=f,l.download="processed.zip",document.body.appendChild(l),l.click(),l.remove(),r("SUKCES: Gotowe (Lokalnie).")}catch(u){r(`BŁĄD LOKALNY: ${u.message}`)}return}const p=new FormData;e.forEach(i=>{p.append("images",i.file)}),p.append("newName",n),p.append("startNumber",t),p.append("optCrop",d),p.append("optTrimOnly",s),p.append("optAddMargin",I.checked),p.append("optResize",$.checked);try{const u=await fetch("http://localhost:3000/upload-tools",{method:"POST",body:p});if(u.ok){r("SUKCES: Pliki przetworzone.");const c=await u.blob(),f=window.URL.createObjectURL(c),l=document.createElement("a");l.href=f,l.download="processed.zip",document.body.appendChild(l),l.click(),l.remove(),r("Rozpoczęto pobieranie archiwum.")}else{const c=await u.text();r(`BŁĄD SERWERA: ${c}`)}}catch(i){r(`BŁĄD SIECI: ${i.message}`)}}
//# sourceMappingURL=tools.js.map

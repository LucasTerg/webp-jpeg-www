const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./assets/client-processor-DndueCvx.js","./assets/vendor-529iNPX7.js"])))=>i.map(i=>d[i]);
import"./assets/modulepreload-polyfill-B5Qt9EMX.js";const x="modulepreload",M=function(e,n){return new URL(e,n).href},S={},_=function(n,t,o){let a=Promise.resolve();if(t&&t.length>0){const m=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),h=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(t.map(c=>{if(c=M(c,o),c in S)return;S[c]=!0;const u=c.endsWith(".css"),s=u?'[rel="stylesheet"]':"";if(!!o)for(let w=m.length-1;w>=0;w--){const L=m[w];if(L.href===c&&(!u||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${s}`))return;const l=document.createElement("link");if(l.rel=u?"stylesheet":x,u||(l.as="script"),l.crossOrigin="",l.href=c,h&&l.setAttribute("nonce",h),document.head.appendChild(l),u)return new Promise((w,L)=>{l.addEventListener("load",w),l.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${c}`)))})}))}function f(m){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=m,window.dispatchEvent(i),!i.defaultPrevented)throw m}return a.then(m=>{for(const i of m||[])i.status==="rejected"&&f(i.reason);return n().catch(f)})};let d=[];const W=(e,n=18)=>{if(e.length<=n)return e;const t=e.split("."),o=t.length>1?`.${t.pop()}`:"",a=t.join("."),f=8,m=6;return a.length<=f?`${a.substring(0,f)}...${o}`:`${a.substring(0,f)}...${a.substring(a.length-m)}${o}`};let y,E,z,B,C,b,R,P,p,T,I,$,U,N,O,F;document.addEventListener("DOMContentLoaded",()=>{console.log("DOM Loaded - initializing Tools"),y=document.getElementById("file-dropzone"),E=document.getElementById("file-input"),z=document.getElementById("file-list"),B=document.getElementById("clear-list"),C=document.getElementById("execute-btn"),b=document.getElementById("console-log"),R=document.getElementById("theme-toggle"),P=document.getElementById("processing-mode"),p=document.getElementById("base-name"),T=document.getElementById("start-number"),N=document.getElementById("mode-smart"),O=document.getElementById("mode-simple"),F=document.getElementById("mode-none"),I=document.getElementById("opt-add-margin"),$=document.getElementById("opt-resize"),U=document.getElementById("opt-overwrite"),window.electronAPI&&(document.body.classList.add("is-electron"),r("Tryb Desktop (Electron) aktywny."));const e=localStorage.getItem("theme")||"dark";if(document.documentElement.setAttribute("data-theme",e),R&&R.addEventListener("click",()=>{const t=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t),r(`Zmiana motywu na: ${t}`)}),y&&E?(y.addEventListener("click",()=>{console.log("Dropzone clicked"),E.click()}),E.addEventListener("change",n=>{D(n.target.files),E.value=""}),y.addEventListener("dragover",n=>{n.preventDefault(),y.style.borderColor="var(--accent-color)"}),y.addEventListener("dragleave",n=>{n.preventDefault(),y.style.borderColor="var(--border-color)"}),y.addEventListener("drop",n=>{n.preventDefault(),y.style.borderColor="var(--border-color)",D(n.dataTransfer.files)})):console.error("Brak elementu dropzone lub fileInput!"),B&&B.addEventListener("click",()=>{d=[],k(),r("Lista wyczyszczona.")}),p){const n=async()=>{try{const t=await navigator.clipboard.readText();if(t){const o=A(t);o&&p.value!==o&&(p.value=o,p.classList.add("flash-input"),setTimeout(()=>p.classList.remove("flash-input"),500),r(`Wklejono ze schowka: ${o}`))}}catch{}};p.addEventListener("mouseenter",n),p.addEventListener("focus",n),window.addEventListener("focus",()=>{p.matches(":hover")&&n()}),p.addEventListener("input",()=>{const t=p.value,o=A(t);t!==o&&(p.value=o)})}C&&C.addEventListener("click",async()=>{Y()})});function r(e){if(!b)return;const n=document.createElement("p");n.textContent=`> ${e}`,b.appendChild(n),b.scrollTop=b.scrollHeight}const A=e=>{const n={ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ó:"o",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ó:"O",Ś:"S",Ź:"Z",Ż:"Z"};let t=e.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g,o=>n[o]);return t=t.replace(/[^a-zA-Z0-9]/g,"-"),t=t.replace(/-+/g,"-"),t=t.replace(/^-+|-+$/g,""),t};function k(){z&&(z.innerHTML="",d.forEach((e,n)=>{const t=document.createElement("li");t.className="file-item";const o=document.createElement("input");o.type="checkbox",o.className="file-select",o.checked=e.selected,o.onchange=i=>{e.selected=i.target.checked};const a=document.createElement("span");a.className="file-info";const f=W(e.file.name);a.textContent=`[${n+1}] ${f} (${(e.file.size/1024).toFixed(1)} KB) (${e.width}x${e.height} px)`,a.title=e.file.name,a.addEventListener("mouseenter",i=>Z(i,e.file)),a.addEventListener("mouseleave",K),a.addEventListener("mousemove",j);const m=document.createElement("div");m.className="file-controls",m.innerHTML=`
        <button class="btn btn-sm" onclick="window.moveUp(${n})">▲</button>
        <button class="btn btn-sm" onclick="window.moveDown(${n})">▼</button>
        <button class="btn btn-sm" onclick="window.removeFile(${n})" style="color:var(--error-color); border-color:var(--error-color);">X</button>
    `,t.appendChild(o),t.appendChild(a),t.appendChild(m),z.appendChild(t)}))}const v=document.getElementById("preview-tooltip");function Z(e,n){if(!v)return;const t=URL.createObjectURL(n);v.innerHTML=`<img src="${t}" alt="Preview">`,v.style.display="block",j(e)}function j(e){if(!v)return;const n=e.clientX+15,t=e.clientY+15;v.style.left=n+"px",v.style.top=t+"px"}function K(){v&&(v.style.display="none",v.innerHTML="")}const H=e=>new Promise((n,t)=>{const o=new Image;o.onload=()=>{URL.revokeObjectURL(o.src),n({width:o.width,height:o.height})},o.onerror=t,o.src=URL.createObjectURL(e)});async function D(e){const n=[];for(const t of Array.from(e))if(t.type.startsWith("image/"))try{const{width:o,height:a}=await H(t);n.push({file:t,id:Date.now()+Math.random(),selected:!0,width:o,height:a}),r(`Dodano: ${t.name} (${o}x${a} px)`)}catch(o){r(`BŁĄD podczas wczytywania wymiarów pliku ${t.name}: ${o.message}`)}else r(`BŁĄD: ${t.name} nie jest obrazem.`);d.push(...n),k()}window.moveUp=e=>{e>0&&([d[e-1],d[e]]=[d[e],d[e-1]],k())};window.moveDown=e=>{e<d.length-1&&([d[e+1],d[e]]=[d[e],d[e+1]],k())};window.removeFile=e=>{const n=d[e];if(n.selected){const t=d.length;d=d.filter(a=>!a.selected);const o=t-d.length;r(`Usunięto zaznaczone pliki: ${o}`)}else r(`Usunięto: ${n.file.name}`),d.splice(e,1);k()};async function Y(){const e=d.filter(c=>c.selected);if(e.length===0){r("BŁĄD: Brak zaznaczonych plików do przetworzenia.");return}const n=p.value.trim()||"image",t=parseInt(T.value)||1,o=P.value,a=N.checked,f=O.checked;F.checked;const m=a,i=f;if(r(`Rozpoczynanie procedury dla ${e.length} plików...`),window.electronAPI){r("Wykryto środowisko Desktop (Electron). Używam natywnego przetwarzania...");let c=e.map(s=>{let g=null;return window.electronAPI.getPathForFile&&(g=window.electronAPI.getPathForFile(s.file)),g||(g=s.file.path),g||(r(`OSTRZEŻENIE: Brak ścieżki dla pliku: ${s.file.name}. Sprawdź uprawnienia lub metodę dodawania.`),null)}).filter(s=>s!==null);if(c.length===0){r("BŁĄD: Nie udało się pobrać ścieżek plików. Operacja przerwana.");return}r(`Wysyłanie ${c.length} plików do procesu głównego...`);const u={baseName:n,startNumber:t,optCrop:m,optTrimOnly:i,optAddMargin:I.checked,optResize:$.checked,optOverwrite:U.checked};window.electronLogListenerAdded||(window.electronAPI.onLog(s=>r(s)),window.electronLogListenerAdded=!0);try{const s=await window.electronAPI.processImages(c,u);s.success?r(`SUKCES: Zapisano w katalogu: ${s.path}`):r(`BŁĄD: ${s.message}`)}catch(s){r(`BŁĄD KRYTYCZNY: ${s.message}`)}return}if(o==="local"){r("Tryb WEB (Lokalny) - start przetwarzania...");const c={baseName:n,startNumber:t,optCrop:m,optTrimOnly:i,optAddMargin:I.checked,optResize:$.checked};try{const{processFilesClientSide:u}=await _(async()=>{const{processFilesClientSide:w}=await import("./assets/client-processor-DndueCvx.js");return{processFilesClientSide:w}},__vite__mapDeps([0,1]),import.meta.url),s=await u(e,c,w=>r(w)),g=window.URL.createObjectURL(s),l=document.createElement("a");l.href=g,l.download="processed.zip",document.body.appendChild(l),l.click(),l.remove(),r("SUKCES: Gotowe (Lokalnie).")}catch(u){r(`BŁĄD LOKALNY: ${u.message}`)}return}const h=new FormData;e.forEach(c=>{h.append("images",c.file)}),h.append("newName",n),h.append("startNumber",t),h.append("optCrop",m),h.append("optTrimOnly",i),h.append("optAddMargin",I.checked),h.append("optResize",$.checked);try{const u=await fetch("http://localhost:3000/upload-tools",{method:"POST",body:h});if(u.ok){r("SUKCES: Pliki przetworzone.");const s=await u.blob(),g=window.URL.createObjectURL(s),l=document.createElement("a");l.href=g,l.download="processed.zip",document.body.appendChild(l),l.click(),l.remove(),r("Rozpoczęto pobieranie archiwum.")}else{const s=await u.text();r(`BŁĄD SERWERA: ${s}`)}}catch(c){r(`BŁĄD SIECI: ${c.message}`)}}
//# sourceMappingURL=tools.js.map

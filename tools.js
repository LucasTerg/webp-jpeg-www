const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/client-processor-CMF70-ce.js","assets/vendor-C_Uzxf6_.js"])))=>i.map(i=>d[i]);
import"./assets/modulepreload-polyfill-B5Qt9EMX.js";const P="modulepreload",N=function(t){return"/webp-jpeg-www/"+t},B={},j=function(n,e,o){let r=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),d=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=Promise.allSettled(e.map(u=>{if(u=N(u),u in B)return;B[u]=!0;const i=u.endsWith(".css"),g=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${g}`))return;const f=document.createElement("link");if(f.rel=i?"stylesheet":P,i||(f.as="script"),f.crossOrigin="",f.href=u,d&&f.setAttribute("nonce",d),document.head.appendChild(f),i)return new Promise((A,O)=>{f.addEventListener("load",A),f.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return r.then(c=>{for(const d of c||[])d.status==="rejected"&&s(d.reason);return n().catch(s)})};let a=[],p,v,y,b,L,w,k,D,m,S,z,I,C,$;document.addEventListener("DOMContentLoaded",()=>{console.log("DOM Loaded - initializing Tools"),p=document.getElementById("file-dropzone"),v=document.getElementById("file-input"),y=document.getElementById("file-list"),b=document.getElementById("clear-list"),L=document.getElementById("execute-btn"),w=document.getElementById("console-log"),k=document.getElementById("theme-toggle"),D=document.getElementById("processing-mode"),m=document.getElementById("base-name"),S=document.getElementById("start-number"),z=document.getElementById("opt-crop"),I=document.getElementById("opt-trim-only"),C=document.getElementById("opt-add-margin"),$=document.getElementById("opt-resize");const t=localStorage.getItem("theme")||"dark";if(document.documentElement.setAttribute("data-theme",t),k&&k.addEventListener("click",()=>{const e=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),l(`Zmiana motywu na: ${e}`)}),p&&v?(p.addEventListener("click",()=>{console.log("Dropzone clicked"),v.click()}),v.addEventListener("change",n=>{U(n.target.files),v.value=""}),p.addEventListener("dragover",n=>{n.preventDefault(),p.style.borderColor="var(--accent-color)"}),p.addEventListener("dragleave",n=>{n.preventDefault(),p.style.borderColor="var(--border-color)"}),p.addEventListener("drop",n=>{n.preventDefault(),p.style.borderColor="var(--border-color)",U(n.dataTransfer.files)})):console.error("Brak elementu dropzone lub fileInput!"),b&&b.addEventListener("click",()=>{a=[],E(),l("Lista wyczyszczona.")}),m){const n=async()=>{try{const e=await navigator.clipboard.readText();if(e){const o=R(e);o&&m.value!==o&&(m.value=o,m.classList.add("flash-input"),setTimeout(()=>m.classList.remove("flash-input"),500),l(`Wklejono ze schowka: ${o}`))}}catch{}};m.addEventListener("mouseenter",n),m.addEventListener("click",n),m.addEventListener("focus",n),window.addEventListener("focus",()=>{m.matches(":hover")&&n()}),m.addEventListener("input",()=>{const e=m.value,o=R(e);e!==o&&(m.value=o)})}L&&L.addEventListener("click",async()=>{M()})});function l(t){if(!w)return;const n=document.createElement("p");n.textContent=`> ${t}`,w.appendChild(n),w.scrollTop=w.scrollHeight}const R=t=>{const n={ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ó:"o",ś:"s",ź:"z",ż:"z",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ó:"O",Ś:"S",Ź:"Z",Ż:"Z"};let e=t.replace(/[ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]/g,o=>n[o]);return e=e.replace(/[^a-zA-Z0-9]/g,"-"),e=e.replace(/-+/g,"-"),e=e.replace(/^-+|-+$/g,""),e};function E(){y&&(y.innerHTML="",a.forEach((t,n)=>{const e=document.createElement("li");e.className="file-item";const o=document.createElement("input");o.type="checkbox",o.className="file-select",o.checked=t.selected,o.onchange=c=>{t.selected=c.target.checked};const r=document.createElement("span");r.className="file-info",r.textContent=`[${n+1}] ${t.file.name} (${(t.file.size/1024).toFixed(1)} KB) (${t.width}x${t.height} px)`,r.addEventListener("mouseenter",c=>x(c,t.file)),r.addEventListener("mouseleave",F),r.addEventListener("mousemove",T);const s=document.createElement("div");s.className="file-controls",s.innerHTML=`
        <button class="btn btn-sm" onclick="window.moveUp(${n})">▲</button>
        <button class="btn btn-sm" onclick="window.moveDown(${n})">▼</button>
        <button class="btn btn-sm" onclick="window.removeFile(${n})" style="color:var(--error-color); border-color:var(--error-color);">X</button>
    `,e.appendChild(o),e.appendChild(r),e.appendChild(s),y.appendChild(e)}))}const h=document.getElementById("preview-tooltip");function x(t,n){if(!h)return;const e=URL.createObjectURL(n);h.innerHTML=`<img src="${e}" alt="Preview">`,h.style.display="block",T(t)}function T(t){if(!h)return;const n=t.clientX+15,e=t.clientY+15;h.style.left=n+"px",h.style.top=e+"px"}function F(){h&&(h.style.display="none",h.innerHTML="")}const _=t=>new Promise((n,e)=>{const o=new Image;o.onload=()=>{URL.revokeObjectURL(o.src),n({width:o.width,height:o.height})},o.onerror=e,o.src=URL.createObjectURL(t)});async function U(t){const n=[];for(const e of Array.from(t))if(e.type.startsWith("image/"))try{const{width:o,height:r}=await _(e);n.push({file:e,id:Date.now()+Math.random(),selected:!0,width:o,height:r}),l(`Dodano: ${e.name} (${o}x${r} px)`)}catch(o){l(`BŁĄD podczas wczytywania wymiarów pliku ${e.name}: ${o.message}`)}else l(`BŁĄD: ${e.name} nie jest obrazem.`);a.push(...n),E()}window.moveUp=t=>{t>0&&([a[t-1],a[t]]=[a[t],a[t-1]],E())};window.moveDown=t=>{t<a.length-1&&([a[t+1],a[t]]=[a[t],a[t+1]],E())};window.removeFile=t=>{const n=a[t];if(n.selected){const e=a.length;a=a.filter(r=>!r.selected);const o=e-a.length;l(`Usunięto zaznaczone pliki: ${o}`)}else l(`Usunięto: ${n.file.name}`),a.splice(t,1);E()};async function M(){const t=a.filter(s=>s.selected);if(t.length===0){l("BŁĄD: Brak zaznaczonych plików do przetworzenia.");return}const n=m.value.trim()||"image",e=parseInt(S.value)||1,o=D.value;if(l(`Rozpoczynanie procedury dla ${t.length} plików (${o==="local"?"LOKALNIE":"SERWER"})...`),o==="local"){const s={baseName:n,startNumber:e,optCrop:z.checked,optTrimOnly:I.checked,optAddMargin:C.checked,optResize:$.checked};try{const{processFilesClientSide:c}=await j(async()=>{const{processFilesClientSide:g}=await import("./assets/client-processor-CMF70-ce.js");return{processFilesClientSide:g}},__vite__mapDeps([0,1])),d=await c(t,s,g=>l(g)),u=window.URL.createObjectURL(d),i=document.createElement("a");i.href=u,i.download="processed.zip",document.body.appendChild(i),i.click(),i.remove(),l("SUKCES: Gotowe (Lokalnie).")}catch(c){l(`BŁĄD LOKALNY: ${c.message}`)}return}const r=new FormData;t.forEach(s=>{r.append("images",s.file)}),r.append("newName",n),r.append("startNumber",e),r.append("optCrop",z.checked),r.append("optTrimOnly",I.checked),r.append("optAddMargin",C.checked),r.append("optResize",$.checked);try{const c=await fetch("http://localhost:3000/upload-tools",{method:"POST",body:r});if(c.ok){l("SUKCES: Pliki przetworzone.");const d=await c.blob(),u=window.URL.createObjectURL(d),i=document.createElement("a");i.href=u,i.download="processed.zip",document.body.appendChild(i),i.click(),i.remove(),l("Rozpoczęto pobieranie archiwum.")}else{const d=await c.text();l(`BŁĄD SERWERA: ${d}`)}}catch(s){l(`BŁĄD SIECI: ${s.message}`)}}
//# sourceMappingURL=tools.js.map
